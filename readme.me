# KI — Self-Choice QLoRA Cycles + Dashboard

Goal: run repeated QLoRA training cycles where the system can self-select a data source (based on validation loss only) and measure stability vs drift, with baselines (fixed/random) and a dashboard for analysis.

## Current status (2025-12-27 snapshot)

- End-to-end cycle runner: `orchestrate_cycle.py`. 
- Source selection: `choose_source.py` (validation-loss based; leak-free by design). 
- Baselines supported: fixed (FORCE_CHOICE), self-choice, random (CHOOSE_MODE=random + seed). (See code in repo.)
- Logs are written as JSONL in the runtime workspace (not tracked in Git):
  - `/workspace/runs/run_log.jsonl`
  - `/workspace/runs/choice_log.jsonl`
- Dashboard (Streamlit) reads these logs, joins by cycle, shows run_type and exports CSV. 

## Active blocker (P0)

Dashboard mismatch: dashboard shows fewer cycles than `run_log.jsonl` (e.g., 26 vs 36). Suspects: join/filters/caching/wrong-path/parser.

P0 deliverable:
- Debug panel in dashboard with counts (raw → parsed → cleaned → joined → filtered → displayed)
- show resolved log paths + mtime + line counts
- list missing `cycle_id`s

## Repo contents (high-signal)

- Orchestration: `orchestrate_cycle.py`, `run_cycle.py` 
- Selection: `choose_source.py` 
- Training: `train_qlora.py`, `train_qlora_247.py` 
- Eval: `eval_cycle0.py`, `eval_cycle1.py` 
- Compare: `compare_cycle.py` 
- Dashboard: `dashboard/` (incl. `dashboard.py`, `log_utils.py`) 
- Sync/push tooling: `sync_to_KI.sh`, `auto_sync_push.sh` 

## Workflow (Workspace ↔ Git mirror)

We work in: `/workspace/` (runtime + development).
We push from: `/workspace/KI/` (Git repo mirror).

`sync_to_KI.sh` rsyncs `/workspace/` → `/workspace/KI/` with `--delete` and excludes for large/runtime dirs (runs, data, clean_data*, models, adapters, etc.). :contentReference[oaicite:12]{index=12}
Rule: do not hand-edit files in `/workspace/KI/` unless you understand how sync will overwrite/delete.

## Sync hygiene

Exclude caches and notebooks checkpoints everywhere:
- `__pycache__`, `.ipynb_checkpoints`, plus common tool caches.
If such folders already exist in Git history, remove them once with `git rm -r` and commit.

## Next TODOs (ordered)

P0:
- Fix dashboard mismatch via debug visibility + correct join strategy.
- Harden log discovery: always show which log file is being read.

P1:
- Analytics from logs: regret (loss(chosen)-minLoss), choice distribution over time, summary stats per run_type.

P2:
- Longer runs + stability analysis + reproducibility pack.
