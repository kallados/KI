[2025-12-26T20:13:09+00:00] RUN: CHOOSE_MODE=loss FORCE_CHOICE= RANDOM_SEED=
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:00<00:02,  1.18it/s]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:02<00:02,  1.44s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:03<00:01,  1.35s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:05<00:00,  1.28s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:05<00:00,  1.28s/it]
Some parameters are on the meta device because they were offloaded to the cpu.
MODE: loss
ADAPTER: /workspace/adapters/qlora_run25
Terminated
[2025-12-26T21:26:50+00:00] ERROR rc=143 consec_fails=1
[2025-12-26T21:27:20+00:00] RUN: CHOOSE_MODE=random FORCE_CHOICE= RANDOM_SEED=12354
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:03<00:10,  3.61s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:08<00:08,  4.21s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:11<00:03,  3.93s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:15<00:00,  3.67s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:15<00:00,  3.78s/it]
MODE: random
ADAPTER: /workspace/adapters/qlora_run26
Terminated
[2025-12-26T21:37:39+00:00] RUN: CHOOSE_MODE=loss FORCE_CHOICE=A RANDOM_SEED=
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:01<00:05,  1.70s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:03<00:03,  1.65s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:04<00:01,  1.65s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:09<00:00,  2.81s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:09<00:00,  2.39s/it]
Some parameters are on the meta device because they were offloaded to the cpu.
MODE: loss
ADAPTER: /workspace/adapters/qlora_run26
Traceback (most recent call last):
  File "/workspace/orchestrate_cycle.py", line 404, in <module>
    main()
  File "/workspace/orchestrate_cycle.py", line 350, in main
    subprocess.run(["python3", str(ROOT / "choose_source.py")], check=True, env=env_choose)
  File "/usr/lib/python3.12/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['python3', '/workspace/choose_source.py']' died with <Signals.SIGKILL: 9>.
[2025-12-26T21:40:46+00:00] RUN: CHOOSE_MODE=loss FORCE_CHOICE=B RANDOM_SEED=
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:01<00:03,  1.25s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:02<00:02,  1.12s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:03<00:01,  1.08s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:04<00:00,  1.07it/s]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:04<00:00,  1.01s/it]
Some parameters are on the meta device because they were offloaded to the cpu.
Some parameters are on the meta device because they were offloaded to the cpu.
MODE: loss
ADAPTER: /workspace/adapters/qlora_run26
Traceback (most recent call last):
  File "/workspace/choose_source.py", line 211, in <module>
    main()
  File "/workspace/choose_source.py", line 179, in main
    choice, losses = choose_by_loss(tok, model)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/choose_source.py", line 139, in choose_by_loss
    losses[k] = avg_loss_per_token(tok, model, texts)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/choose_source.py", line 116, in avg_loss_per_token
    out = model(**enc, labels=enc["input_ids"])
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/accelerate/hooks.py", line 175, in new_forward
    output = module._old_forward(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/peft/peft_model.py", line 1923, in forward
    return self.base_model(
           ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/peft/tuners/tuners_utils.py", line 308, in forward
    return self.model.forward(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/accelerate/hooks.py", line 175, in new_forward
    output = module._old_forward(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/utils/generic.py", line 918, in wrapper
    output = func(self, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/models/qwen2/modeling_qwen2.py", line 463, in forward
    logits = self.lm_head(hidden_states[:, slice_indices, :])
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/accelerate/hooks.py", line 170, in new_forward
    args, kwargs = module._hf_hook.pre_forward(module, *args, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/accelerate/hooks.py", line 360, in pre_forward
    set_module_tensor_to_device(
  File "/usr/local/lib/python3.12/dist-packages/accelerate/utils/modeling.py", line 343, in set_module_tensor_to_device
    new_value = value.to(device, non_blocking=non_blocking)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.02 GiB. GPU 0 has a total capacity of 15.48 GiB of which 365.75 MiB is free. Including non-PyTorch memory, this process has 1.66 GiB memory in use. Process 23423 has 8.32 GiB memory in use. Process 23454 has 5.12 GiB memory in use. Of the allocated memory 1.49 GiB is allocated by PyTorch, and 15.43 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
Traceback (most recent call last):
  File "/workspace/orchestrate_cycle.py", line 404, in <module>
    main()
  File "/workspace/orchestrate_cycle.py", line 350, in main
    subprocess.run(["python3", str(ROOT / "choose_source.py")], check=True, env=env_choose)
  File "/usr/lib/python3.12/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['python3', '/workspace/choose_source.py']' returned non-zero exit status 1.
[2025-12-26T21:42:21+00:00] RUN: CHOOSE_MODE=loss FORCE_CHOICE=C RANDOM_SEED=
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:06<00:20,  6.98s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:12<00:11,  5.95s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:14<00:04,  4.30s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:22<00:00,  5.72s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:22<00:00,  5.62s/it]
MODE: loss
ADAPTER: /workspace/adapters/qlora_run26
Traceback (most recent call last):
  File "/workspace/orchestrate_cycle.py", line 404, in <module>
    main()
  File "/workspace/orchestrate_cycle.py", line 350, in main
    subprocess.run(["python3", str(ROOT / "choose_source.py")], check=True, env=env_choose)
  File "/usr/lib/python3.12/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['python3', '/workspace/choose_source.py']' died with <Signals.SIGKILL: 9>.
[2025-12-26T22:07:59+00:00] RUN: CHOOSE_MODE=loss FORCE_CHOICE= RANDOM_SEED=
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:01<00:04,  1.57s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:03<00:03,  1.56s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:04<00:01,  1.53s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:06<00:00,  1.63s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:06<00:00,  1.60s/it]
Some parameters are on the meta device because they were offloaded to the cpu.
MODE: loss
ADAPTER: /workspace/adapters/qlora_run27
Traceback (most recent call last):
  File "/workspace/orchestrate_cycle.py", line 404, in <module>
    main()
  File "/workspace/orchestrate_cycle.py", line 350, in main
    subprocess.run(["python3", str(ROOT / "choose_source.py")], check=True, env=env_choose)
  File "/usr/lib/python3.12/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['python3', '/workspace/choose_source.py']' died with <Signals.SIGKILL: 9>.
[2025-12-26T22:10:59+00:00] ERROR rc=1 consec_fails=1
[2025-12-26T22:11:29+00:00] RUN: CHOOSE_MODE=random FORCE_CHOICE= RANDOM_SEED=12357
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:01<00:03,  1.33s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:02<00:02,  1.19s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:03<00:01,  1.15s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:04<00:00,  1.14s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:04<00:00,  1.16s/it]
Some parameters are on the meta device because they were offloaded to the cpu.
Some parameters are on the meta device because they were offloaded to the cpu.
MODE: random
ADAPTER: /workspace/adapters/qlora_run27
LOSSES: {'A': 2.4285958744585514, 'B': 2.605314848944545, 'C': 3.2203608863055706}
CHOICE: B
WROTE: /workspace/choice.txt
orchestrator: cycle_next = 28 | choice = B | mode = random
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:01<00:05,  1.90s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:04<00:04,  2.15s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:06<00:02,  2.26s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:08<00:00,  2.04s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:08<00:00,  2.08s/it]
Map:   0%|                                                                                                               | 0/28107 [00:00<?, ? examples/s]Map:   2%|█▋                                                                                                 | 465/28107 [00:00<00:06, 4573.79 examples/s]Map:   4%|███▍                                                                                              | 1000/28107 [00:00<00:07, 3859.38 examples/s]Map:   5%|████▉                                                                                             | 1413/28107 [00:00<00:10, 2496.22 examples/s]Map:   6%|██████▏                                                                                           | 1785/28107 [00:00<00:13, 2020.53 examples/s]Map:   7%|███████▏                                                                                          | 2046/28107 [00:01<00:16, 1610.82 examples/s]Map:   9%|████████▉                                                                                         | 2561/28107 [00:01<00:11, 2261.99 examples/s]Map:  10%|██████████▏                                                                                       | 2906/28107 [00:01<00:10, 2505.99 examples/s]Map:  12%|███████████▎                                                                                      | 3243/28107 [00:01<00:14, 1759.81 examples/s]Map:  12%|████████████▏                                                                                     | 3511/28107 [00:01<00:19, 1250.23 examples/s]Map:  13%|█████████████▏                                                                                    | 3794/28107 [00:02<00:17, 1373.97 examples/s]Map:  14%|█████████████▉                                                                                    | 4000/28107 [00:02<00:19, 1268.73 examples/s]Map:  15%|██████████████▌                                                                                   | 4168/28107 [00:02<00:18, 1261.55 examples/s]Map:  16%|███████████████▏                                                                                  | 4359/28107 [00:02<00:18, 1260.73 examples/s]Map:  17%|████████████████▊                                                                                 | 4839/28107 [00:02<00:12, 1930.61 examples/s]Map:  18%|█████████████████▊                                                                                | 5103/28107 [00:02<00:11, 2080.85 examples/s]Map:  20%|███████████████████▊                                                                              | 5682/28107 [00:02<00:07, 2944.37 examples/s]Map:  22%|█████████████████████                                                                             | 6046/28107 [00:03<00:08, 2511.38 examples/s]Map:  23%|██████████████████████▎                                                                           | 6390/28107 [00:03<00:12, 1739.96 examples/s]Map:  24%|███████████████████████▏                                                                          | 6633/28107 [00:03<00:14, 1476.25 examples/s]Map:  24%|███████████████████████▉                                                                          | 6852/28107 [00:03<00:14, 1470.22 examples/s]Map:  25%|████████████████████████▋                                                                         | 7097/28107 [00:04<00:17, 1211.83 examples/s]Map:  26%|█████████████████████████▎                                                                        | 7256/28107 [00:04<00:17, 1175.23 examples/s]Map:  28%|███████████████████████████▍                                                                      | 7861/28107 [00:04<00:10, 2008.83 examples/s]Map:  29%|████████████████████████████▋                                                                     | 8223/28107 [00:04<00:08, 2324.79 examples/s]Map:  31%|██████████████████████████████                                                                    | 8615/28107 [00:04<00:11, 1745.79 examples/s]Map:  32%|██████████████████████████████▉                                                                   | 8870/28107 [00:05<00:13, 1399.64 examples/s]Map:  32%|███████████████████████████████▋                                                                  | 9082/28107 [00:05<00:17, 1100.25 examples/s]Map:  35%|█████████████████████████████████▉                                                                | 9720/28107 [00:05<00:10, 1823.76 examples/s]Map:  37%|████████████████████████████████████                                                             | 10435/28107 [00:05<00:06, 2695.85 examples/s]Map:  40%|██████████████████████████████████████▍                                                          | 11139/28107 [00:05<00:04, 3517.99 examples/s]Map:  42%|████████████████████████████████████████▊                                                        | 11827/28107 [00:05<00:03, 4231.24 examples/s]Map:  45%|███████████████████████████████████████████▋                                                     | 12641/28107 [00:05<00:03, 5138.69 examples/s]Map:  48%|██████████████████████████████████████████████▌                                                  | 13497/28107 [00:06<00:02, 5992.63 examples/s]Map:  51%|█████████████████████████████████████████████████▊                                               | 14422/28107 [00:06<00:01, 6844.11 examples/s]Map:  54%|████████████████████████████████████████████████████▌                                            | 15231/28107 [00:06<00:01, 7182.00 examples/s]Map:  58%|███████████████████████████████████████████████████████▉                                         | 16220/28107 [00:06<00:01, 6963.67 examples/s]Map:  60%|██████████████████████████████████████████████████████████▌                                      | 16972/28107 [00:06<00:01, 7106.72 examples/s]Map:  64%|██████████████████████████████████████████████████████████████▏                                  | 18018/28107 [00:06<00:01, 7053.70 examples/s]Map:  68%|█████████████████████████████████████████████████████████████████▌                               | 18984/28107 [00:06<00:01, 7713.47 examples/s]Map:  72%|█████████████████████████████████████████████████████████████████████▎                           | 20101/28107 [00:06<00:01, 7614.13 examples/s]Map:  75%|████████████████████████████████████████████████████████████████████████▌                        | 21021/28107 [00:07<00:00, 8008.09 examples/s]Map:  78%|███████████████████████████████████████████████████████████████████████████▌                     | 21907/28107 [00:07<00:00, 7259.26 examples/s]Map:  81%|██████████████████████████████████████████████████████████████████████████████▉                  | 22862/28107 [00:07<00:00, 6164.67 examples/s]Map:  84%|█████████████████████████████████████████████████████████████████████████████████▊               | 23706/28107 [00:07<00:00, 6662.30 examples/s]Map:  88%|█████████████████████████████████████████████████████████████████████████████████████            | 24632/28107 [00:07<00:00, 7280.35 examples/s]Map:  91%|███████████████████████████████████████████████████████████████████████████████████████▊         | 25460/28107 [00:07<00:00, 7527.66 examples/s]Map:  95%|████████████████████████████████████████████████████████████████████████████████████████████     | 26670/28107 [00:07<00:00, 7709.71 examples/s]Map:  98%|███████████████████████████████████████████████████████████████████████████████████████████████▌ | 27676/28107 [00:07<00:00, 8296.57 examples/s]Map: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 28107/28107 [00:08<00:00, 3502.67 examples/s]
TRAIN: cycle28  choice=B  data=/workspace/clean_data_norm/latest/B/dialog.txt  prev=/workspace/adapters/qlora_run27  exclude=2000
  0%|                                                                                                                             | 0/200 [00:00<?, ?it/s]  0%|▌                                                                                                                    | 1/200 [00:04<16:28,  4.97s/it]  1%|█▏                                                                                                                   | 2/200 [00:08<14:30,  4.40s/it]Traceback (most recent call last):
  File "/workspace/run_cycle.py", line 169, in <module>
    main()
  File "/workspace/run_cycle.py", line 145, in main
    trainer.train()
  File "/usr/local/lib/python3.12/dist-packages/transformers/trainer.py", line 2325, in train
    return inner_training_loop(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/trainer.py", line 2674, in _inner_training_loop
    tr_loss_step = self.training_step(model, inputs, num_items_in_batch)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/trainer.py", line 4071, in training_step
    self.accelerator.backward(loss, **kwargs)
  File "/usr/local/lib/python3.12/dist-packages/accelerate/accelerator.py", line 2848, in backward
    self.scaler.scale(loss).backward(**kwargs)
  File "/usr/local/lib/python3.12/dist-packages/torch/_tensor.py", line 625, in backward
    torch.autograd.backward(
  File "/usr/local/lib/python3.12/dist-packages/torch/autograd/__init__.py", line 354, in backward
    _engine_run_backward(
  File "/usr/local/lib/python3.12/dist-packages/torch/autograd/graph.py", line 841, in _engine_run_backward
    return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 138.00 MiB. GPU 0 has a total capacity of 15.48 GiB of which 13.75 MiB is free. Process 24119 has 2.66 GiB memory in use. Including non-PyTorch memory, this process has 7.67 GiB memory in use. Process 24207 has 5.12 GiB memory in use. Of the allocated memory 7.16 GiB is allocated by PyTorch, and 357.35 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
  1%|█▏                                                                                                                   | 2/200 [00:12<20:34,  6.24s/it]
Traceback (most recent call last):
  File "/workspace/orchestrate_cycle.py", line 404, in <module>
    main()
  File "/workspace/orchestrate_cycle.py", line 369, in main
    subprocess.run(["python3", str(ROOT / "run_cycle.py")], check=True, env=env_train)
  File "/usr/lib/python3.12/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['python3', '/workspace/run_cycle.py']' returned non-zero exit status 1.
[2025-12-26T22:13:15+00:00] RUN: CHOOSE_MODE=loss FORCE_CHOICE=A RANDOM_SEED=
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:07<00:21,  7.12s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:13<00:12,  6.43s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:16<00:05,  5.14s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:23<00:00,  5.95s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:23<00:00,  5.97s/it]
Some parameters are on the meta device because they were offloaded to the cpu.
MODE: loss
ADAPTER: /workspace/adapters/qlora_run27
Traceback (most recent call last):
  File "/workspace/orchestrate_cycle.py", line 404, in <module>
    main()
  File "/workspace/orchestrate_cycle.py", line 350, in main
    subprocess.run(["python3", str(ROOT / "choose_source.py")], check=True, env=env_choose)
  File "/usr/lib/python3.12/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['python3', '/workspace/choose_source.py']' died with <Signals.SIGKILL: 9>.
[2025-12-26T22:28:50+00:00] RUN: CHOOSE_MODE=loss FORCE_CHOICE=B RANDOM_SEED=
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:06<00:19,  6.44s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:13<00:13,  6.54s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:19<00:06,  6.32s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:23<00:00,  5.61s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:23<00:00,  5.91s/it]
Some parameters are on the meta device because they were offloaded to the cpu.
Traceback (most recent call last):
  File "/workspace/orchestrate_cycle.py", line 404, in <module>
    main()
  File "/workspace/orchestrate_cycle.py", line 350, in main
    subprocess.run(["python3", str(ROOT / "choose_source.py")], check=True, env=env_choose)
  File "/usr/lib/python3.12/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['python3', '/workspace/choose_source.py']' died with <Signals.SIGKILL: 9>.
[2025-12-26T22:29:54+00:00] RUN: CHOOSE_MODE=loss FORCE_CHOICE=C RANDOM_SEED=
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:01<?, ?it/s]
Traceback (most recent call last):
  File "/workspace/choose_source.py", line 211, in <module>
    main()
  File "/workspace/choose_source.py", line 158, in main
    tok, model = load_model_with_adapter(adapter)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/choose_source.py", line 94, in load_model_with_adapter
    model = AutoModelForCausalLM.from_pretrained(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/models/auto/auto_factory.py", line 604, in from_pretrained
    return model_class.from_pretrained(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 277, in _wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 5048, in from_pretrained
    ) = cls._load_pretrained_model(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 5468, in _load_pretrained_model
    _error_msgs, disk_offload_index = load_shard_file(args)
                                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 843, in load_shard_file
    disk_offload_index = _load_state_dict_into_meta_model(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/utils/_contextlib.py", line 120, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 770, in _load_state_dict_into_meta_model
    _load_parameter_into_model(model, param_name, param.to(param_device))
                                                  ^^^^^^^^^^^^^^^^^^^^^^
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 130.00 MiB. GPU 0 has a total capacity of 15.48 GiB of which 12.88 MiB is free. Including non-PyTorch memory, this process has 3.02 GiB memory in use. Process 24760 has 12.43 GiB memory in use. Of the allocated memory 2.88 GiB is allocated by PyTorch, and 16.90 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
Traceback (most recent call last):
  File "/workspace/orchestrate_cycle.py", line 404, in <module>
    main()
  File "/workspace/orchestrate_cycle.py", line 350, in main
    subprocess.run(["python3", str(ROOT / "choose_source.py")], check=True, env=env_choose)
  File "/usr/lib/python3.12/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['python3', '/workspace/choose_source.py']' returned non-zero exit status 1.
[2025-12-26T22:30:03+00:00] RUN: CHOOSE_MODE=loss FORCE_CHOICE= RANDOM_SEED=
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:00<00:02,  1.35it/s]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:01<00:01,  1.44it/s]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:02<00:00,  1.52it/s]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:02<00:00,  1.64it/s]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:02<00:00,  1.57it/s]
Some parameters are on the meta device because they were offloaded to the cpu.
/usr/local/lib/python3.12/dist-packages/accelerate/utils/modeling.py:1566: UserWarning: Current model requires 256 bytes of buffer for offloaded layers, which seems does not fit any GPU's remaining memory. If you are experiencing a OOM later, please consider using offload_buffers=True.
  warnings.warn(
MODE: loss
ADAPTER: /workspace/adapters/qlora_run27
Traceback (most recent call last):
  File "/workspace/orchestrate_cycle.py", line 404, in <module>
    main()
  File "/workspace/orchestrate_cycle.py", line 350, in main
    subprocess.run(["python3", str(ROOT / "choose_source.py")], check=True, env=env_choose)
  File "/usr/lib/python3.12/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['python3', '/workspace/choose_source.py']' died with <Signals.SIGKILL: 9>.
[2025-12-26T22:37:22+00:00] ERROR rc=1 consec_fails=1
[2025-12-26T22:37:52+00:00] RUN: CHOOSE_MODE=random FORCE_CHOICE= RANDOM_SEED=12360
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:06<00:20,  6.80s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:12<00:12,  6.27s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:18<00:06,  6.25s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:28<00:00,  7.50s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:28<00:00,  7.09s/it]
Some parameters are on the meta device because they were offloaded to the cpu.
Some parameters are on the meta device because they were offloaded to the cpu.
MODE: random
ADAPTER: /workspace/adapters/qlora_run27
LOSSES: {'A': 2.4285958744585514, 'B': 2.605314848944545, 'C': 3.2203608863055706}
CHOICE: C
WROTE: /workspace/choice.txt
orchestrator: cycle_next = 28 | choice = C | mode = random
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:24<01:13, 24.52s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:50<00:51, 25.60s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [01:24<00:29, 29.34s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [01:49<00:00, 27.63s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [01:49<00:00, 27.42s/it]
Map:   0%|                                                                                                               | 0/18000 [00:00<?, ? examples/s]Map:   0%|                                                                                                      | 11/18000 [00:00<05:43, 52.30 examples/s]Map:   0%|▏                                                                                                     | 27/18000 [00:00<04:04, 73.38 examples/s]Map:   0%|▏                                                                                                     | 37/18000 [00:00<03:48, 78.65 examples/s]Map:   0%|▎                                                                                                     | 59/18000 [00:00<03:07, 95.60 examples/s]Map:   0%|▍                                                                                                    | 77/18000 [00:00<02:42, 110.44 examples/s]Map:   1%|▌                                                                                                    | 99/18000 [00:00<02:38, 112.96 examples/s]Map:   1%|▋                                                                                                   | 114/18000 [00:01<02:57, 101.02 examples/s]Map:   1%|▊                                                                                                   | 148/18000 [00:01<02:22, 125.33 examples/s]Map:   1%|█▏                                                                                                  | 215/18000 [00:01<01:15, 234.57 examples/s]Map:   2%|█▉                                                                                                  | 340/18000 [00:01<00:42, 415.20 examples/s]Map:   2%|██▏                                                                                                 | 404/18000 [00:01<00:43, 404.83 examples/s]Map:   3%|██▊                                                                                                 | 501/18000 [00:02<00:53, 326.64 examples/s]Map:   3%|███                                                                                                 | 550/18000 [00:02<00:49, 352.88 examples/s]Map:   3%|███▎                                                                                                | 606/18000 [00:02<00:44, 389.91 examples/s]Map:   4%|███▉                                                                                                | 705/18000 [00:02<00:40, 428.65 examples/s]Map:   5%|████▋                                                                                               | 834/18000 [00:02<00:34, 500.45 examples/s]Map:   5%|█████▎                                                                                              | 958/18000 [00:02<00:31, 539.45 examples/s]Map:   6%|█████▌                                                                                             | 1015/18000 [00:03<00:48, 348.91 examples/s]Map:   6%|█████▉                                                                                             | 1069/18000 [00:03<00:48, 350.83 examples/s]Map:   6%|██████▏                                                                                            | 1127/18000 [00:03<00:50, 332.66 examples/s]Map:   7%|██████▍                                                                                            | 1174/18000 [00:03<00:47, 354.83 examples/s]Map:   7%|███████▍                                                                                           | 1345/18000 [00:03<00:29, 565.08 examples/s]Map:   8%|███████▊                                                                                           | 1414/18000 [00:04<00:33, 489.92 examples/s]Map:   8%|████████                                                                                           | 1474/18000 [00:04<00:38, 429.35 examples/s]Map:   9%|████████▍                                                                                          | 1543/18000 [00:04<00:40, 403.32 examples/s]Map:   9%|████████▊                                                                                          | 1599/18000 [00:04<00:45, 364.29 examples/s]Map:   9%|█████████                                                                                          | 1657/18000 [00:04<00:47, 342.01 examples/s]Map:  10%|█████████▍                                                                                         | 1716/18000 [00:05<00:42, 386.22 examples/s]Map:  10%|██████████▎                                                                                        | 1864/18000 [00:05<00:29, 553.60 examples/s]Map:  11%|██████████▋                                                                                        | 1938/18000 [00:05<00:29, 536.83 examples/s]Map:  11%|███████████                                                                                        | 2000/18000 [00:05<00:37, 430.49 examples/s]Map:  12%|███████████▍                                                                                       | 2078/18000 [00:05<00:32, 483.04 examples/s]Map:  12%|███████████▉                                                                                       | 2173/18000 [00:05<00:30, 525.55 examples/s]Map:  13%|████████████▌                                                                                      | 2281/18000 [00:06<00:29, 531.39 examples/s]Map:  13%|█████████████▏                                                                                     | 2393/18000 [00:06<00:26, 589.02 examples/s]Map:  14%|█████████████▌                                                                                     | 2471/18000 [00:06<00:32, 480.74 examples/s]Map:  14%|██████████████▏                                                                                    | 2579/18000 [00:06<00:30, 499.50 examples/s]Map:  15%|██████████████▌                                                                                    | 2638/18000 [00:06<00:29, 515.64 examples/s]Map:  15%|██████████████▉                                                                                    | 2706/18000 [00:06<00:27, 549.41 examples/s]Map:  16%|███████████████▌                                                                                   | 2833/18000 [00:07<00:26, 581.14 examples/s]Map:  16%|████████████████▎                                                                                  | 2967/18000 [00:07<00:24, 612.14 examples/s]Map:  17%|████████████████▊                                                                                  | 3057/18000 [00:07<00:31, 478.87 examples/s]Map:  17%|█████████████████                                                                                  | 3111/18000 [00:07<00:30, 488.67 examples/s]Map:  18%|█████████████████▋                                                                                 | 3210/18000 [00:07<00:30, 491.11 examples/s]Map:  18%|██████████████████                                                                                 | 3291/18000 [00:07<00:26, 549.26 examples/s]Map:  19%|██████████████████▋                                                                                | 3406/18000 [00:08<00:26, 558.11 examples/s]Map:  20%|███████████████████▎                                                                               | 3517/18000 [00:08<00:25, 558.75 examples/s]Map:  20%|███████████████████▉                                                                               | 3619/18000 [00:08<00:26, 542.84 examples/s]Map:  21%|████████████████████▍                                                                              | 3723/18000 [00:08<00:26, 535.34 examples/s]Map:  21%|████████████████████▉                                                                              | 3812/18000 [00:08<00:27, 507.78 examples/s]Map:  22%|█████████████████████▊                                                                             | 3964/18000 [00:09<00:22, 634.44 examples/s]Map:  22%|██████████████████████▏                                                                            | 4034/18000 [00:09<00:27, 502.34 examples/s]Map:  23%|██████████████████████▌                                                                            | 4112/18000 [00:09<00:29, 468.88 examples/s]Map:  23%|██████████████████████▉                                                                            | 4163/18000 [00:09<00:29, 475.26 examples/s]Map:  24%|███████████████████████▍                                                                           | 4268/18000 [00:09<00:25, 537.69 examples/s]Map:  24%|███████████████████████▊                                                                           | 4332/18000 [00:09<00:26, 506.56 examples/s]Map:  24%|████████████████████████▏                                                                          | 4389/18000 [00:10<00:26, 519.71 examples/s]Map:  25%|████████████████████████▌                                                                          | 4461/18000 [00:10<00:23, 564.24 examples/s]Map:  25%|█████████████████████████                                                                          | 4562/18000 [00:10<00:24, 542.35 examples/s]Map:  26%|█████████████████████████▊                                                                         | 4693/18000 [00:10<00:22, 582.18 examples/s]Map:  27%|██████████████████████████▎                                                                        | 4778/18000 [00:10<00:22, 578.19 examples/s]Map:  27%|██████████████████████████▋                                                                        | 4860/18000 [00:10<00:25, 519.75 examples/s]Map:  27%|███████████████████████████                                                                        | 4918/18000 [00:11<00:24, 529.55 examples/s]Map:  28%|███████████████████████████▍                                                                       | 4983/18000 [00:11<00:25, 503.08 examples/s]Map:  28%|███████████████████████████▋                                                                       | 5037/18000 [00:11<00:30, 418.93 examples/s]Map:  29%|████████████████████████████▎                                                                      | 5159/18000 [00:11<00:22, 582.09 examples/s]Map:  29%|█████████████████████████████                                                                      | 5277/18000 [00:11<00:21, 586.16 examples/s]Map:  30%|██████████████████████████████                                                                     | 5463/18000 [00:11<00:17, 706.23 examples/s]Map:  31%|██████████████████████████████▌                                                                    | 5562/18000 [00:11<00:16, 761.11 examples/s]Map:  32%|███████████████████████████████▎                                                                   | 5704/18000 [00:12<00:16, 743.11 examples/s]Map:  32%|████████████████████████████████▏                                                                  | 5848/18000 [00:12<00:16, 735.40 examples/s]Map:  33%|████████████████████████████████▋                                                                  | 5950/18000 [00:12<00:18, 661.80 examples/s]Map:  34%|█████████████████████████████████▎                                                                 | 6055/18000 [00:12<00:22, 531.29 examples/s]Map:  34%|█████████████████████████████████▊                                                                 | 6143/18000 [00:13<00:21, 545.58 examples/s]Map:  35%|██████████████████████████████████▏                                                                | 6211/18000 [00:13<00:20, 568.11 examples/s]Map:  35%|██████████████████████████████████▌                                                                | 6276/18000 [00:13<00:21, 533.25 examples/s]Map:  35%|██████████████████████████████████▉                                                                | 6343/18000 [00:13<00:22, 507.96 examples/s]Map:  36%|███████████████████████████████████▏                                                               | 6407/18000 [00:13<00:23, 485.07 examples/s]Map:  36%|███████████████████████████████████▋                                                               | 6495/18000 [00:13<00:24, 468.43 examples/s]Map:  36%|████████████████████████████████████▏                                                              | 6569/18000 [00:13<00:21, 522.16 examples/s]Map:  37%|████████████████████████████████████▌                                                              | 6646/18000 [00:13<00:19, 574.70 examples/s]Map:  37%|█████████████████████████████████████                                                              | 6741/18000 [00:14<00:25, 439.11 examples/s]Map:  38%|█████████████████████████████████████▍                                                             | 6810/18000 [00:14<00:26, 420.52 examples/s]Map:  39%|██████████████████████████████████████▎                                                            | 6957/18000 [00:14<00:21, 520.08 examples/s]Map:  39%|██████████████████████████████████████▋                                                            | 7023/18000 [00:14<00:23, 461.08 examples/s]Map:  40%|███████████████████████████████████████▋                                                           | 7214/18000 [00:14<00:14, 723.08 examples/s]Map:  41%|████████████████████████████████████████▎                                                          | 7340/18000 [00:15<00:15, 692.00 examples/s]Map:  41%|████████████████████████████████████████▉                                                          | 7433/18000 [00:15<00:17, 615.55 examples/s]Map:  42%|█████████████████████████████████████████▋                                                         | 7582/18000 [00:15<00:15, 659.24 examples/s]Map:  43%|██████████████████████████████████████████▏                                                        | 7669/18000 [00:15<00:14, 698.11 examples/s]Map:  43%|██████████████████████████████████████████▊                                                        | 7793/18000 [00:15<00:15, 670.52 examples/s]Map:  44%|███████████████████████████████████████████▍                                                       | 7900/18000 [00:16<00:16, 625.31 examples/s]Map:  44%|████████████████████████████████████████████                                                       | 8000/18000 [00:16<00:18, 555.35 examples/s]Map:  45%|████████████████████████████████████████████▌                                                      | 8093/18000 [00:16<00:16, 604.05 examples/s]Map:  45%|████████████████████████████████████████████▉                                                      | 8163/18000 [00:16<00:17, 567.94 examples/s]Map:  46%|█████████████████████████████████████████████▍                                                     | 8265/18000 [00:16<00:17, 547.14 examples/s]Map:  46%|█████████████████████████████████████████████▉                                                     | 8357/18000 [00:16<00:15, 619.72 examples/s]Map:  47%|██████████████████████████████████████████████▍                                                    | 8435/18000 [00:16<00:14, 654.56 examples/s]Map:  47%|██████████████████████████████████████████████▉                                                    | 8527/18000 [00:17<00:13, 714.52 examples/s]Map:  48%|███████████████████████████████████████████████▌                                                   | 8654/18000 [00:17<00:13, 687.06 examples/s]Map:  49%|████████████████████████████████████████████████▏                                                  | 8760/18000 [00:17<00:16, 575.18 examples/s]Map:  50%|█████████████████████████████████████████████████▍                                                 | 8980/18000 [00:17<00:11, 808.43 examples/s]Map:  50%|█████████████████████████████████████████████████▉                                                 | 9072/18000 [00:17<00:13, 639.96 examples/s]Map:  51%|██████████████████████████████████████████████████▍                                                | 9180/18000 [00:18<00:15, 567.54 examples/s]Map:  52%|███████████████████████████████████████████████████▏                                               | 9311/18000 [00:18<00:13, 638.86 examples/s]Map:  52%|███████████████████████████████████████████████████▋                                               | 9404/18000 [00:18<00:13, 633.54 examples/s]Map:  53%|████████████████████████████████████████████████████▎                                              | 9503/18000 [00:18<00:16, 507.41 examples/s]Map:  53%|████████████████████████████████████████████████████▊                                              | 9597/18000 [00:18<00:16, 495.94 examples/s]Map:  54%|█████████████████████████████████████████████████████▏                                             | 9668/18000 [00:19<00:18, 455.14 examples/s]Map:  54%|█████████████████████████████████████████████████████▋                                             | 9766/18000 [00:19<00:17, 466.34 examples/s]Map:  55%|██████████████████████████████████████████████████████                                             | 9838/18000 [00:19<00:16, 509.91 examples/s]Map:  55%|██████████████████████████████████████████████████████▍                                            | 9896/18000 [00:19<00:15, 522.94 examples/s]Map:  56%|██████████████████████████████████████████████████████▍                                           | 10000/18000 [00:19<00:16, 483.34 examples/s]Map:  56%|██████████████████████████████████████████████████████▊                                           | 10061/18000 [00:19<00:15, 502.65 examples/s]Map:  56%|███████████████████████████████████████████████████████▏                                          | 10129/18000 [00:20<00:16, 487.78 examples/s]Map:  57%|███████████████████████████████████████████████████████▉                                          | 10267/18000 [00:20<00:12, 614.65 examples/s]Map:  58%|████████████████████████████████████████████████████████▍                                         | 10359/18000 [00:20<00:13, 559.92 examples/s]Map:  59%|█████████████████████████████████████████████████████████▊                                        | 10630/18000 [00:20<00:07, 997.75 examples/s]Map:  60%|██████████████████████████████████████████████████████████▊                                       | 10797/18000 [00:20<00:08, 857.82 examples/s]Map:  61%|███████████████████████████████████████████████████████████▋                                      | 10972/18000 [00:20<00:08, 864.44 examples/s]Map:  62%|████████████████████████████████████████████████████████████▌                                     | 11123/18000 [00:21<00:10, 629.70 examples/s]Map:  63%|█████████████████████████████████████████████████████████████▍                                    | 11287/18000 [00:21<00:09, 677.73 examples/s]Map:  63%|█████████████████████████████████████████████████████████████▉                                    | 11382/18000 [00:21<00:10, 618.31 examples/s]Map:  64%|██████████████████████████████████████████████████████████████▍                                   | 11458/18000 [00:21<00:11, 556.71 examples/s]Map:  64%|██████████████████████████████████████████████████████████████▉                                   | 11567/18000 [00:22<00:11, 555.13 examples/s]Map:  65%|███████████████████████████████████████████████████████████████▌                                  | 11686/18000 [00:22<00:10, 611.08 examples/s]Map:  65%|████████████████████████████████████████████████████████████████▏                                 | 11781/18000 [00:22<00:11, 528.11 examples/s]Map:  66%|████████████████████████████████████████████████████████████████▍                                 | 11846/18000 [00:22<00:11, 548.28 examples/s]Map:  66%|█████████████████████████████████████████████████████████████████                                 | 11941/18000 [00:22<00:11, 525.21 examples/s]Map:  67%|█████████████████████████████████████████████████████████████████▎                                | 12000/18000 [00:23<00:13, 449.88 examples/s]Map:  68%|███████████████████████████████████████████████████████████████████                               | 12314/18000 [00:23<00:06, 945.50 examples/s]Map:  69%|███████████████████████████████████████████████████████████████████▉                              | 12487/18000 [00:23<00:08, 671.31 examples/s]Map:  70%|████████████████████████████████████████████████████████████████████▉                             | 12656/18000 [00:23<00:08, 608.71 examples/s]Map:  71%|█████████████████████████████████████████████████████████████████████▍                            | 12762/18000 [00:24<00:09, 555.82 examples/s]Map:  71%|█████████████████████████████████████████████████████████████████████▉                            | 12840/18000 [00:24<00:10, 514.95 examples/s]Map:  72%|██████████████████████████████████████████████████████████████████████▎                           | 12907/18000 [00:24<00:10, 467.34 examples/s]Map:  72%|██████████████████████████████████████████████████████████████████████▊                           | 12997/18000 [00:24<00:10, 463.80 examples/s]Map:  73%|███████████████████████████████████████████████████████████████████████                           | 13053/18000 [00:24<00:12, 411.78 examples/s]Map:  73%|███████████████████████████████████████████████████████████████████████▍                          | 13126/18000 [00:25<00:12, 398.98 examples/s]Map:  73%|███████████████████████████████████████████████████████████████████████▉                          | 13205/18000 [00:25<00:11, 428.85 examples/s]Map:  74%|████████████████████████████████████████████████████████████████████████▏                         | 13257/18000 [00:25<00:10, 444.66 examples/s]Map:  74%|████████████████████████████████████████████████████████████████████████▌                         | 13324/18000 [00:25<00:10, 444.40 examples/s]Map:  75%|█████████████████████████████████████████████████████████████████████████▏                        | 13435/18000 [00:25<00:08, 531.04 examples/s]Map:  75%|█████████████████████████████████████████████████████████████████████████▋                        | 13536/18000 [00:25<00:07, 630.64 examples/s]Map:  76%|██████████████████████████████████████████████████████████████████████████                        | 13607/18000 [00:25<00:07, 583.85 examples/s]Map:  76%|██████████████████████████████████████████████████████████████████████████▊                       | 13735/18000 [00:26<00:07, 605.82 examples/s]Map:  78%|████████████████████████████████████████████████████████████████████████████                      | 13966/18000 [00:26<00:04, 966.30 examples/s]Map:  79%|████████████████████████████████████████████████████████████████████████████▌                    | 14216/18000 [00:26<00:02, 1321.24 examples/s]Map:  81%|██████████████████████████████████████████████████████████████████████████████▍                  | 14550/18000 [00:26<00:01, 1821.57 examples/s]Map:  82%|███████████████████████████████████████████████████████████████████████████████▉                 | 14835/18000 [00:26<00:01, 2090.15 examples/s]Map:  85%|██████████████████████████████████████████████████████████████████████████████████               | 15230/18000 [00:26<00:01, 2042.03 examples/s]Map:  86%|███████████████████████████████████████████████████████████████████████████████████▋             | 15538/18000 [00:26<00:01, 2283.89 examples/s]Map:  88%|█████████████████████████████████████████████████████████████████████████████████████▌           | 15885/18000 [00:26<00:00, 2578.38 examples/s]Map:  91%|████████████████████████████████████████████████████████████████████████████████████████▍        | 16417/18000 [00:27<00:00, 2617.75 examples/s]Map:  94%|███████████████████████████████████████████████████████████████████████████████████████████▌     | 17000/18000 [00:27<00:00, 2718.58 examples/s]Map:  97%|██████████████████████████████████████████████████████████████████████████████████████████████▍  | 17524/18000 [00:27<00:00, 2695.28 examples/s]Map:  99%|████████████████████████████████████████████████████████████████████████████████████████████████ | 17827/18000 [00:27<00:00, 2301.56 examples/s]Map: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████| 18000/18000 [00:28<00:00, 638.55 examples/s]
TRAIN: cycle28  choice=C  data=/workspace/clean_data_norm/latest/C/philosophy.txt  prev=/workspace/adapters/qlora_run27  exclude=2000
  0%|                                                                                                                             | 0/200 [00:00<?, ?it/s]  0%|▌                                                                                                                    | 1/200 [00:12<41:30, 12.51s/it]  1%|█▏                                                                                                                   | 2/200 [00:23<38:58, 11.81s/it]Traceback (most recent call last):
  File "/workspace/run_cycle.py", line 169, in <module>
    main()
  File "/workspace/run_cycle.py", line 145, in main
    trainer.train()
  File "/usr/local/lib/python3.12/dist-packages/transformers/trainer.py", line 2325, in train
    return inner_training_loop(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/trainer.py", line 2674, in _inner_training_loop
    tr_loss_step = self.training_step(model, inputs, num_items_in_batch)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/trainer.py", line 4020, in training_step
    loss = self.compute_loss(model, inputs, num_items_in_batch=num_items_in_batch)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/trainer.py", line 4110, in compute_loss
    outputs = model(**inputs)
              ^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/accelerate/utils/operations.py", line 819, in forward
    return model_forward(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/accelerate/utils/operations.py", line 807, in __call__
    return convert_to_fp32(self.model_forward(*args, **kwargs))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/amp/autocast_mode.py", line 44, in decorate_autocast
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/peft/peft_model.py", line 1923, in forward
    return self.base_model(
           ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/peft/tuners/tuners_utils.py", line 308, in forward
    return self.model.forward(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/utils/generic.py", line 918, in wrapper
    output = func(self, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/models/qwen2/modeling_qwen2.py", line 449, in forward
    outputs: BaseModelOutputWithPast = self.model(
                                       ^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/utils/generic.py", line 1072, in wrapper
    outputs = func(self, *args, **kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/models/qwen2/modeling_qwen2.py", line 384, in forward
    hidden_states = decoder_layer(
                    ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_layers.py", line 94, in __call__
    return super().__call__(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/utils/deprecation.py", line 172, in wrapped_func
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/models/qwen2/modeling_qwen2.py", line 249, in forward
    hidden_states = self.mlp(hidden_states)
                    ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/models/qwen2/modeling_qwen2.py", line 46, in forward
    down_proj = self.down_proj(self.act_fn(self.gate_proj(x)) * self.up_proj(x))
                                           ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/bitsandbytes/nn/modules.py", line 555, in forward
    return bnb.matmul_4bit(x, weight, bias=bias, quant_state=quant_state).to(inp_dtype)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/bitsandbytes/autograd/_functions.py", line 401, in matmul_4bit
    return MatMul4Bit.apply(A, B, out, bias, quant_state)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/autograd/function.py", line 581, in apply
    return super().apply(*args, **kwargs)  # type: ignore[misc]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/bitsandbytes/autograd/_functions.py", line 315, in forward
    output = torch.nn.functional.linear(A, F.dequantize_4bit(B, quant_state).to(A.dtype).t(), bias)
                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 260.00 MiB. GPU 0 has a total capacity of 15.48 GiB of which 259.75 MiB is free. Process 25078 has 5.57 GiB memory in use. Process 25197 has 2.09 GiB memory in use. Including non-PyTorch memory, this process has 7.55 GiB memory in use. Of the allocated memory 7.18 GiB is allocated by PyTorch, and 212.99 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
  1%|█▏                                                                                                                   | 2/200 [00:28<46:58, 14.24s/it]
Traceback (most recent call last):
  File "/workspace/orchestrate_cycle.py", line 404, in <module>
    main()
  File "/workspace/orchestrate_cycle.py", line 369, in main
    subprocess.run(["python3", str(ROOT / "run_cycle.py")], check=True, env=env_train)
  File "/usr/lib/python3.12/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['python3', '/workspace/run_cycle.py']' returned non-zero exit status 1.
[2025-12-26T22:47:33+00:00] RUN: CHOOSE_MODE=loss FORCE_CHOICE=A RANDOM_SEED=
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:06<00:18,  6.21s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:11<00:11,  5.91s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:17<00:05,  5.82s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:22<00:00,  5.31s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:22<00:00,  5.54s/it]
Some parameters are on the meta device because they were offloaded to the cpu.
Traceback (most recent call last):
  File "/workspace/orchestrate_cycle.py", line 404, in <module>
    main()
  File "/workspace/orchestrate_cycle.py", line 350, in main
    subprocess.run(["python3", str(ROOT / "choose_source.py")], check=True, env=env_choose)
  File "/usr/lib/python3.12/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['python3', '/workspace/choose_source.py']' died with <Signals.SIGKILL: 9>.
[2025-12-26T22:48:44+00:00] RUN: CHOOSE_MODE=loss FORCE_CHOICE=B RANDOM_SEED=
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:01<00:05,  1.93s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:04<00:04,  2.30s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:06<00:02,  2.30s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:08<00:00,  2.08s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:08<00:00,  2.13s/it]
Some parameters are on the meta device because they were offloaded to the cpu.
MODE: loss
ADAPTER: /workspace/adapters/qlora_run27
LOSSES: {'A': 2.428990939632058, 'B': 2.605516716837883, 'C': 3.2204685360193253}
FORCED_CHOICE: B (was A )
CHOICE: B
WROTE: /workspace/choice.txt
orchestrator: cycle_next = 28 | choice = B | mode = loss
Traceback (most recent call last):
  File "/workspace/run_cycle.py", line 169, in <module>
    main()
  File "/workspace/run_cycle.py", line 107, in main
    base = load_bnb_model()
           ^^^^^^^^^^^^^^^^
  File "/workspace/run_cycle.py", line 48, in load_bnb_model
    model = AutoModelForCausalLM.from_pretrained(BASE_MODEL, quantization_config=bnb, device_map="auto")
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/models/auto/auto_factory.py", line 604, in from_pretrained
    return model_class.from_pretrained(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 277, in _wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 5029, in from_pretrained
    device_map = _get_device_map(model, device_map, max_memory, hf_quantizer, dtype, keep_in_fp32_regex)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 1365, in _get_device_map
    hf_quantizer.validate_environment(device_map=device_map)
  File "/usr/local/lib/python3.12/dist-packages/transformers/quantizers/quantizer_bnb_4bit.py", line 127, in validate_environment
    raise ValueError(
ValueError: Some modules are dispatched on the CPU or the disk. Make sure you have enough GPU RAM to fit the quantized model. If you want to dispatch the model on the CPU or the disk while keeping these modules in 32-bit, you need to set `llm_int8_enable_fp32_cpu_offload=True` and pass a custom `device_map` to `from_pretrained`. Check https://huggingface.co/docs/transformers/main/en/main_classes/quantization#offload-between-cpu-and-gpu for more details. 
Traceback (most recent call last):
  File "/workspace/orchestrate_cycle.py", line 404, in <module>
    main()
  File "/workspace/orchestrate_cycle.py", line 369, in main
    subprocess.run(["python3", str(ROOT / "run_cycle.py")], check=True, env=env_train)
  File "/usr/lib/python3.12/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['python3', '/workspace/run_cycle.py']' returned non-zero exit status 1.
[2025-12-27T01:54:27+00:00] RUN: CHOOSE_MODE=loss FORCE_CHOICE=C RANDOM_SEED=
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:04<00:12,  4.32s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:06<00:06,  3.27s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:09<00:02,  2.81s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:11<00:00,  2.65s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:11<00:00,  2.88s/it]
Some parameters are on the meta device because they were offloaded to the cpu.
MODE: loss
ADAPTER: /workspace/adapters/qlora_run31
LOSSES: {'A': 2.4965546429157257, 'B': 2.363584393635392, 'C': 3.1093932054936886}
FORCED_CHOICE: C (was B )
CHOICE: C
WROTE: /workspace/choice.txt
orchestrator: cycle_next = 32 | choice = C | mode = loss
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:06<00:19,  6.49s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:14<00:15,  7.67s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:19<00:06,  6.32s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:22<00:00,  4.83s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:22<00:00,  5.56s/it]
Map:   0%|                                                                                                               | 0/18000 [00:00<?, ? examples/s]Map:   2%|█▉                                                                                                 | 351/18000 [00:00<00:05, 3493.05 examples/s]Map:   5%|█████                                                                                              | 915/18000 [00:00<00:06, 2636.95 examples/s]Map:   7%|██████▋                                                                                           | 1233/18000 [00:00<00:08, 1898.83 examples/s]Map:  10%|██████████▏                                                                                       | 1872/18000 [00:00<00:05, 2949.45 examples/s]Map:  13%|████████████▎                                                                                     | 2254/18000 [00:00<00:04, 3164.71 examples/s]Map:  15%|██████████████▊                                                                                   | 2730/18000 [00:00<00:04, 3576.35 examples/s]Map:  18%|█████████████████▍                                                                                | 3203/18000 [00:01<00:06, 2263.57 examples/s]Map:  21%|█████████████████████                                                                             | 3863/18000 [00:01<00:04, 3063.95 examples/s]Map:  24%|███████████████████████▍                                                                          | 4297/18000 [00:01<00:04, 3116.60 examples/s]Map:  27%|██████████████████████████▋                                                                       | 4903/18000 [00:01<00:03, 3385.41 examples/s]Map:  31%|██████████████████████████████▌                                                                   | 5607/18000 [00:01<00:03, 3154.52 examples/s]Map:  33%|████████████████████████████████▊                                                                 | 6018/18000 [00:01<00:03, 3335.45 examples/s]Map:  36%|██████████████████████████████████▉                                                               | 6413/18000 [00:02<00:03, 3463.12 examples/s]Map:  38%|█████████████████████████████████████▎                                                            | 6850/18000 [00:02<00:03, 3673.88 examples/s]Map:  41%|████████████████████████████████████████▌                                                         | 7443/18000 [00:02<00:02, 3759.96 examples/s]Map:  44%|███████████████████████████████████████████                                                       | 7919/18000 [00:02<00:02, 3994.94 examples/s]Map:  48%|██████████████████████████████████████████████▉                                                   | 8610/18000 [00:02<00:02, 3741.74 examples/s]Map:  52%|██████████████████████████████████████████████████▉                                               | 9348/18000 [00:02<00:02, 3092.59 examples/s]Map:  54%|████████████████████████████████████████████████████▉                                             | 9718/18000 [00:03<00:02, 2790.29 examples/s]Map:  57%|██████████████████████████████████████████████████████▉                                          | 10183/18000 [00:03<00:02, 3127.01 examples/s]Map:  59%|█████████████████████████████████████████████████████████▋                                       | 10698/18000 [00:03<00:02, 3210.60 examples/s]Map:  61%|███████████████████████████████████████████████████████████▌                                     | 11051/18000 [00:03<00:02, 3277.13 examples/s]Map:  63%|█████████████████████████████████████████████████████████████▌                                   | 11418/18000 [00:03<00:02, 2495.44 examples/s]Map:  66%|████████████████████████████████████████████████████████████████                                 | 11888/18000 [00:03<00:02, 2927.30 examples/s]Map:  69%|██████████████████████████████████████████████████████████████████▋                              | 12369/18000 [00:04<00:02, 2325.34 examples/s]Map:  72%|██████████████████████████████████████████████████████████████████████                           | 13000/18000 [00:04<00:01, 2999.40 examples/s]Map:  74%|████████████████████████████████████████████████████████████████████████▏                        | 13404/18000 [00:04<00:01, 2910.33 examples/s]Map:  77%|██████████████████████████████████████████████████████████████████████████▍                      | 13811/18000 [00:04<00:01, 3149.68 examples/s]Map:  80%|█████████████████████████████████████████████████████████████████████████████▎                   | 14337/18000 [00:04<00:01, 2872.58 examples/s]Map:  83%|████████████████████████████████████████████████████████████████████████████████▏                | 14880/18000 [00:04<00:00, 3236.64 examples/s]Map:  86%|██████████████████████████████████████████████████████████████████████████████████▉              | 15391/18000 [00:04<00:00, 3285.91 examples/s]Map:  88%|█████████████████████████████████████████████████████████████████████████████████████▎           | 15834/18000 [00:05<00:00, 3185.14 examples/s]Map:  91%|████████████████████████████████████████████████████████████████████████████████████████▏        | 16364/18000 [00:05<00:00, 3585.43 examples/s]Map:  93%|██████████████████████████████████████████████████████████████████████████████████████████▍      | 16786/18000 [00:05<00:00, 3733.10 examples/s]Map:  96%|█████████████████████████████████████████████████████████████████████████████████████████████▏   | 17286/18000 [00:05<00:00, 3596.65 examples/s]Map:  99%|███████████████████████████████████████████████████████████████████████████████████████████████▌ | 17737/18000 [00:05<00:00, 3126.90 examples/s]Map: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 18000/18000 [00:05<00:00, 3084.90 examples/s]
TRAIN: cycle32  choice=C  data=/workspace/clean_data_norm/latest/C/philosophy.txt  prev=/workspace/adapters/qlora_run31  exclude=2000
  0%|                                                                                                                             | 0/200 [00:00<?, ?it/s]  0%|▌                                                                                                                    | 1/200 [00:04<16:02,  4.84s/it]  1%|█▏                                                                                                                   | 2/200 [00:08<13:12,  4.00s/it]  2%|█▊                                                                                                                   | 3/200 [00:11<12:42,  3.87s/it]  2%|██▎                                                                                                                  | 4/200 [00:15<12:15,  3.75s/it]  2%|██▉                                                                                                                  | 5/200 [00:18<11:43,  3.61s/it]  3%|███▌                                                                                                                 | 6/200 [00:22<11:29,  3.55s/it]  4%|████                                                                                                                 | 7/200 [00:26<11:43,  3.64s/it]  4%|████▋                                                                                                                | 8/200 [00:29<11:27,  3.58s/it]  4%|█████▎                                                                                                               | 9/200 [00:33<11:17,  3.55s/it]  5%|█████▊                                                                                                              | 10/200 [00:36<11:06,  3.51s/it]  6%|██████▍                                                                                                             | 11/200 [00:39<10:52,  3.45s/it]  6%|██████▉                                                                                                             | 12/200 [00:43<10:39,  3.40s/it]  6%|███████▌                                                                                                            | 13/200 [00:46<10:43,  3.44s/it]  7%|████████                                                                                                            | 14/200 [00:49<10:34,  3.41s/it]  8%|████████▋                                                                                                           | 15/200 [00:53<10:27,  3.39s/it]  8%|█████████▎                                                                                                          | 16/200 [00:56<10:20,  3.37s/it]  8%|█████████▊                                                                                                          | 17/200 [01:00<11:01,  3.61s/it]  9%|██████████▍                                                                                                         | 18/200 [01:04<10:55,  3.60s/it] 10%|███████████                                                                                                         | 19/200 [01:08<11:00,  3.65s/it] 10%|███████████▌                                                                                                        | 20/200 [01:11<10:54,  3.64s/it]                                                                                                                                                          {'loss': 1.5127, 'grad_norm': 3.5435538291931152, 'learning_rate': 0.000181, 'epoch': 0.01}
 10%|███████████▌                                                                                                        | 20/200 [01:11<10:54,  3.64s/it] 10%|████████████▏                                                                                                       | 21/200 [01:15<10:48,  3.62s/it] 11%|████████████▊                                                                                                       | 22/200 [01:19<10:53,  3.67s/it] 12%|█████████████▎                                                                                                      | 23/200 [01:23<11:20,  3.84s/it] 12%|█████████████▉                                                                                                      | 24/200 [01:27<11:34,  3.95s/it] 12%|██████████████▌                                                                                                     | 25/200 [01:31<11:28,  3.94s/it] 13%|███████████████                                                                                                     | 26/200 [01:35<11:32,  3.98s/it] 14%|███████████████▋                                                                                                    | 27/200 [01:39<11:19,  3.93s/it] 14%|████████████████▏                                                                                                   | 28/200 [01:43<11:23,  3.97s/it] 14%|████████████████▊                                                                                                   | 29/200 [01:47<11:16,  3.96s/it] 15%|█████████████████▍                                                                                                  | 30/200 [01:51<11:14,  3.97s/it] 16%|█████████████████▉                                                                                                  | 31/200 [01:55<11:25,  4.06s/it] 16%|██████████████████▌                                                                                                 | 32/200 [01:59<11:19,  4.05s/it] 16%|███████████████████▏                                                                                                | 33/200 [02:03<10:53,  3.92s/it] 17%|███████████████████▋                                                                                                | 34/200 [02:07<10:46,  3.89s/it] 18%|████████████████████▎                                                                                               | 35/200 [02:10<10:35,  3.85s/it] 18%|████████████████████▉                                                                                               | 36/200 [02:14<10:39,  3.90s/it] 18%|█████████████████████▍                                                                                              | 37/200 [02:18<10:34,  3.89s/it] 19%|██████████████████████                                                                                              | 38/200 [02:22<10:15,  3.80s/it] 20%|██████████████████████▌                                                                                             | 39/200 [02:26<10:18,  3.84s/it] 20%|███████████████████████▏                                                                                            | 40/200 [02:31<11:14,  4.22s/it]                                                                                                                                                          {'loss': 1.6209, 'grad_norm': 2.4544920921325684, 'learning_rate': 0.000161, 'epoch': 0.02}
 20%|███████████████████████▏                                                                                            | 40/200 [02:31<11:14,  4.22s/it] 20%|███████████████████████▊                                                                                            | 41/200 [02:35<11:22,  4.29s/it] 21%|████████████████████████▎                                                                                           | 42/200 [02:40<11:19,  4.30s/it] 22%|████████████████████████▉                                                                                           | 43/200 [02:44<11:21,  4.34s/it] 22%|█████████████████████████▌                                                                                          | 44/200 [02:48<10:59,  4.23s/it] 22%|██████████████████████████                                                                                          | 45/200 [02:52<10:49,  4.19s/it] 23%|██████████████████████████▋                                                                                         | 46/200 [02:56<10:30,  4.09s/it] 24%|███████████████████████████▎                                                                                        | 47/200 [03:00<10:08,  3.98s/it] 24%|███████████████████████████▊                                                                                        | 48/200 [03:03<09:47,  3.86s/it] 24%|████████████████████████████▍                                                                                       | 49/200 [03:07<09:41,  3.85s/it] 25%|█████████████████████████████                                                                                       | 50/200 [03:11<09:45,  3.90s/it] 26%|█████████████████████████████▌                                                                                      | 51/200 [03:15<09:27,  3.81s/it] 26%|██████████████████████████████▏                                                                                     | 52/200 [03:20<10:15,  4.16s/it] 26%|██████████████████████████████▋                                                                                     | 53/200 [03:23<09:49,  4.01s/it] 27%|███████████████████████████████▎                                                                                    | 54/200 [03:27<09:20,  3.84s/it] 28%|███████████████████████████████▉                                                                                    | 55/200 [03:31<09:10,  3.80s/it] 28%|████████████████████████████████▍                                                                                   | 56/200 [03:34<09:12,  3.84s/it] 28%|█████████████████████████████████                                                                                   | 57/200 [03:38<09:10,  3.85s/it] 29%|█████████████████████████████████▋                                                                                  | 58/200 [03:42<08:59,  3.80s/it] 30%|██████████████████████████████████▏                                                                                 | 59/200 [03:47<09:40,  4.12s/it] 30%|██████████████████████████████████▊                                                                                 | 60/200 [03:51<09:41,  4.16s/it]                                                                                                                                                          {'loss': 1.7703, 'grad_norm': 1.8983073234558105, 'learning_rate': 0.000141, 'epoch': 0.03}
 30%|██████████████████████████████████▊                                                                                 | 60/200 [03:51<09:41,  4.16s/it] 30%|███████████████████████████████████▍                                                                                | 61/200 [03:55<09:29,  4.09s/it] 31%|███████████████████████████████████▉                                                                                | 62/200 [03:59<09:03,  3.94s/it] 32%|████████████████████████████████████▌                                                                               | 63/200 [04:03<09:02,  3.96s/it] 32%|█████████████████████████████████████                                                                               | 64/200 [04:07<08:55,  3.94s/it] 32%|█████████████████████████████████████▋                                                                              | 65/200 [04:10<08:41,  3.86s/it] 33%|██████████████████████████████████████▎                                                                             | 66/200 [04:14<08:43,  3.90s/it] 34%|██████████████████████████████████████▊                                                                             | 67/200 [04:18<08:37,  3.89s/it] 34%|███████████████████████████████████████▍                                                                            | 68/200 [04:24<09:41,  4.41s/it] 34%|████████████████████████████████████████                                                                            | 69/200 [04:28<09:46,  4.48s/it] 35%|████████████████████████████████████████▌                                                                           | 70/200 [04:32<09:19,  4.30s/it] 36%|█████████████████████████████████████████▏                                                                          | 71/200 [04:36<09:07,  4.24s/it] 36%|█████████████████████████████████████████▊                                                                          | 72/200 [04:40<08:47,  4.12s/it] 36%|██████████████████████████████████████████▎                                                                         | 73/200 [04:44<08:45,  4.13s/it] 37%|██████████████████████████████████████████▉                                                                         | 74/200 [04:49<08:59,  4.28s/it] 38%|███████████████████████████████████████████▌                                                                        | 75/200 [04:53<08:48,  4.22s/it] 38%|████████████████████████████████████████████                                                                        | 76/200 [04:57<08:32,  4.13s/it] 38%|████████████████████████████████████████████▋                                                                       | 77/200 [05:01<08:18,  4.05s/it] 39%|█████████████████████████████████████████████▏                                                                      | 78/200 [05:04<07:57,  3.91s/it] 40%|█████████████████████████████████████████████▊                                                                      | 79/200 [05:09<08:06,  4.02s/it] 40%|██████████████████████████████████████████████▍                                                                     | 80/200 [05:13<08:04,  4.04s/it]                                                                                                                                                          {'loss': 1.76, 'grad_norm': 2.784942150115967, 'learning_rate': 0.000121, 'epoch': 0.04}
 40%|██████████████████████████████████████████████▍                                                                     | 80/200 [05:13<08:04,  4.04s/it] 40%|██████████████████████████████████████████████▉                                                                     | 81/200 [05:17<08:01,  4.05s/it] 41%|███████████████████████████████████████████████▌                                                                    | 82/200 [05:21<07:57,  4.05s/it] 42%|████████████████████████████████████████████████▏                                                                   | 83/200 [05:25<07:46,  3.99s/it] 42%|████████████████████████████████████████████████▋                                                                   | 84/200 [05:29<07:38,  3.95s/it] 42%|█████████████████████████████████████████████████▎                                                                  | 85/200 [05:33<07:32,  3.94s/it] 43%|█████████████████████████████████████████████████▉                                                                  | 86/200 [05:37<07:31,  3.96s/it] 44%|██████████████████████████████████████████████████▍                                                                 | 87/200 [05:41<07:39,  4.07s/it] 44%|███████████████████████████████████████████████████                                                                 | 88/200 [05:45<07:30,  4.02s/it] 44%|███████████████████████████████████████████████████▌                                                                | 89/200 [05:48<07:01,  3.79s/it] 45%|████████████████████████████████████████████████████▏                                                               | 90/200 [05:52<06:57,  3.80s/it] 46%|████████████████████████████████████████████████████▊                                                               | 91/200 [05:56<07:00,  3.86s/it] 46%|█████████████████████████████████████████████████████▎                                                              | 92/200 [06:00<06:54,  3.83s/it] 46%|█████████████████████████████████████████████████████▉                                                              | 93/200 [06:04<07:09,  4.01s/it] 47%|██████████████████████████████████████████████████████▌                                                             | 94/200 [06:08<07:01,  3.98s/it] 48%|███████████████████████████████████████████████████████                                                             | 95/200 [06:12<07:01,  4.02s/it] 48%|███████████████████████████████████████████████████████▋                                                            | 96/200 [06:16<06:48,  3.93s/it] 48%|████████████████████████████████████████████████████████▎                                                           | 97/200 [06:20<06:52,  4.01s/it] 49%|████████████████████████████████████████████████████████▊                                                           | 98/200 [06:24<06:54,  4.06s/it] 50%|█████████████████████████████████████████████████████████▍                                                          | 99/200 [06:28<06:37,  3.93s/it] 50%|█████████████████████████████████████████████████████████▌                                                         | 100/200 [06:32<06:46,  4.06s/it]                                                                                                                                                          {'loss': 2.0186, 'grad_norm': 1.7915246486663818, 'learning_rate': 0.000101, 'epoch': 0.04}
 50%|█████████████████████████████████████████████████████████▌                                                         | 100/200 [06:32<06:46,  4.06s/it] 50%|██████████████████████████████████████████████████████████                                                         | 101/200 [06:36<06:39,  4.04s/it] 51%|██████████████████████████████████████████████████████████▋                                                        | 102/200 [06:40<06:21,  3.89s/it] 52%|███████████████████████████████████████████████████████████▏                                                       | 103/200 [06:44<06:17,  3.89s/it] 52%|███████████████████████████████████████████████████████████▊                                                       | 104/200 [06:48<06:14,  3.90s/it] 52%|████████████████████████████████████████████████████████████▍                                                      | 105/200 [06:51<06:07,  3.87s/it] 53%|████████████████████████████████████████████████████████████▉                                                      | 106/200 [06:55<06:09,  3.93s/it] 54%|█████████████████████████████████████████████████████████████▌                                                     | 107/200 [07:00<06:17,  4.06s/it] 54%|██████████████████████████████████████████████████████████████                                                     | 108/200 [07:04<06:07,  3.99s/it] 55%|██████████████████████████████████████████████████████████████▋                                                    | 109/200 [07:08<06:03,  4.00s/it] 55%|███████████████████████████████████████████████████████████████▎                                                   | 110/200 [07:11<05:55,  3.95s/it] 56%|███████████████████████████████████████████████████████████████▊                                                   | 111/200 [07:15<05:39,  3.81s/it] 56%|████████████████████████████████████████████████████████████████▍                                                  | 112/200 [07:18<05:28,  3.73s/it] 56%|████████████████████████████████████████████████████████████████▉                                                  | 113/200 [07:22<05:26,  3.75s/it] 57%|█████████████████████████████████████████████████████████████████▌                                                 | 114/200 [07:26<05:10,  3.62s/it] 57%|██████████████████████████████████████████████████████████████████▏                                                | 115/200 [07:29<05:04,  3.59s/it] 58%|██████████████████████████████████████████████████████████████████▋                                                | 116/200 [07:33<05:11,  3.70s/it] 58%|███████████████████████████████████████████████████████████████████▎                                               | 117/200 [07:37<05:02,  3.65s/it] 59%|███████████████████████████████████████████████████████████████████▊                                               | 118/200 [07:40<04:55,  3.60s/it] 60%|████████████████████████████████████████████████████████████████████▍                                              | 119/200 [07:44<05:04,  3.76s/it] 60%|█████████████████████████████████████████████████████████████████████                                              | 120/200 [07:48<05:04,  3.81s/it]                                                                                                                                                          {'loss': 2.0913, 'grad_norm': 2.0455400943756104, 'learning_rate': 8.1e-05, 'epoch': 0.05}
 60%|█████████████████████████████████████████████████████████████████████                                              | 120/200 [07:48<05:04,  3.81s/it] 60%|█████████████████████████████████████████████████████████████████████▌                                             | 121/200 [07:52<05:04,  3.85s/it] 61%|██████████████████████████████████████████████████████████████████████▏                                            | 122/200 [07:56<04:57,  3.82s/it] 62%|██████████████████████████████████████████████████████████████████████▋                                            | 123/200 [08:00<04:59,  3.89s/it] 62%|███████████████████████████████████████████████████████████████████████▎                                           | 124/200 [08:04<05:05,  4.01s/it] 62%|███████████████████████████████████████████████████████████████████████▉                                           | 125/200 [08:08<04:58,  3.98s/it] 63%|████████████████████████████████████████████████████████████████████████▍                                          | 126/200 [08:12<04:45,  3.86s/it] 64%|█████████████████████████████████████████████████████████████████████████                                          | 127/200 [08:15<04:32,  3.73s/it] 64%|█████████████████████████████████████████████████████████████████████████▌                                         | 128/200 [08:19<04:23,  3.66s/it] 64%|██████████████████████████████████████████████████████████████████████████▏                                        | 129/200 [08:22<04:18,  3.64s/it] 65%|██████████████████████████████████████████████████████████████████████████▊                                        | 130/200 [08:26<04:10,  3.57s/it] 66%|███████████████████████████████████████████████████████████████████████████▎                                       | 131/200 [08:29<04:10,  3.63s/it] 66%|███████████████████████████████████████████████████████████████████████████▉                                       | 132/200 [08:33<04:07,  3.64s/it] 66%|████████████████████████████████████████████████████████████████████████████▍                                      | 133/200 [08:36<04:00,  3.59s/it] 67%|█████████████████████████████████████████████████████████████████████████████                                      | 134/200 [08:40<03:59,  3.63s/it] 68%|█████████████████████████████████████████████████████████████████████████████▋                                     | 135/200 [08:44<03:53,  3.59s/it] 68%|██████████████████████████████████████████████████████████████████████████████▏                                    | 136/200 [08:47<03:50,  3.61s/it] 68%|██████████████████████████████████████████████████████████████████████████████▊                                    | 137/200 [08:51<03:47,  3.60s/it] 69%|███████████████████████████████████████████████████████████████████████████████▎                                   | 138/200 [08:55<03:42,  3.59s/it] 70%|███████████████████████████████████████████████████████████████████████████████▉                                   | 139/200 [08:58<03:39,  3.59s/it] 70%|████████████████████████████████████████████████████████████████████████████████▌                                  | 140/200 [09:02<03:38,  3.64s/it]                                                                                                                                                          {'loss': 2.0988, 'grad_norm': 1.8540669679641724, 'learning_rate': 6.1e-05, 'epoch': 0.06}
 70%|████████████████████████████████████████████████████████████████████████████████▌                                  | 140/200 [09:02<03:38,  3.64s/it] 70%|█████████████████████████████████████████████████████████████████████████████████                                  | 141/200 [09:05<03:34,  3.63s/it] 71%|█████████████████████████████████████████████████████████████████████████████████▋                                 | 142/200 [09:09<03:32,  3.66s/it] 72%|██████████████████████████████████████████████████████████████████████████████████▏                                | 143/200 [09:13<03:29,  3.67s/it] 72%|██████████████████████████████████████████████████████████████████████████████████▊                                | 144/200 [09:17<03:27,  3.70s/it] 72%|███████████████████████████████████████████████████████████████████████████████████▍                               | 145/200 [09:21<03:26,  3.75s/it] 73%|███████████████████████████████████████████████████████████████████████████████████▉                               | 146/200 [09:24<03:19,  3.69s/it] 74%|████████████████████████████████████████████████████████████████████████████████████▌                              | 147/200 [09:28<03:17,  3.73s/it] 74%|█████████████████████████████████████████████████████████████████████████████████████                              | 148/200 [09:32<03:13,  3.72s/it] 74%|█████████████████████████████████████████████████████████████████████████████████████▋                             | 149/200 [09:35<03:06,  3.66s/it] 75%|██████████████████████████████████████████████████████████████████████████████████████▎                            | 150/200 [09:39<03:01,  3.62s/it] 76%|██████████████████████████████████████████████████████████████████████████████████████▊                            | 151/200 [09:42<02:55,  3.59s/it] 76%|███████████████████████████████████████████████████████████████████████████████████████▍                           | 152/200 [09:46<02:54,  3.64s/it] 76%|███████████████████████████████████████████████████████████████████████████████████████▉                           | 153/200 [09:50<02:50,  3.64s/it] 77%|████████████████████████████████████████████████████████████████████████████████████████▌                          | 154/200 [09:53<02:42,  3.54s/it] 78%|█████████████████████████████████████████████████████████████████████████████████████████▏                         | 155/200 [09:56<02:38,  3.53s/it] 78%|█████████████████████████████████████████████████████████████████████████████████████████▋                         | 156/200 [10:00<02:34,  3.52s/it] 78%|██████████████████████████████████████████████████████████████████████████████████████████▎                        | 157/200 [10:03<02:31,  3.51s/it] 79%|██████████████████████████████████████████████████████████████████████████████████████████▊                        | 158/200 [10:07<02:28,  3.54s/it] 80%|███████████████████████████████████████████████████████████████████████████████████████████▍                       | 159/200 [10:10<02:23,  3.50s/it] 80%|████████████████████████████████████████████████████████████████████████████████████████████                       | 160/200 [10:14<02:17,  3.44s/it]                                                                                                                                                          {'loss': 2.1426, 'grad_norm': 2.9231059551239014, 'learning_rate': 4.1e-05, 'epoch': 0.07}
 80%|████████████████████████████████████████████████████████████████████████████████████████████                       | 160/200 [10:14<02:17,  3.44s/it] 80%|████████████████████████████████████████████████████████████████████████████████████████████▌                      | 161/200 [10:17<02:15,  3.48s/it] 81%|█████████████████████████████████████████████████████████████████████████████████████████████▏                     | 162/200 [10:21<02:15,  3.56s/it] 82%|█████████████████████████████████████████████████████████████████████████████████████████████▋                     | 163/200 [10:24<02:07,  3.45s/it] 82%|██████████████████████████████████████████████████████████████████████████████████████████████▎                    | 164/200 [10:28<02:05,  3.50s/it] 82%|██████████████████████████████████████████████████████████████████████████████████████████████▉                    | 165/200 [10:31<02:01,  3.46s/it] 83%|███████████████████████████████████████████████████████████████████████████████████████████████▍                   | 166/200 [10:35<01:57,  3.45s/it] 84%|████████████████████████████████████████████████████████████████████████████████████████████████                   | 167/200 [10:38<01:56,  3.52s/it] 84%|████████████████████████████████████████████████████████████████████████████████████████████████▌                  | 168/200 [10:42<01:53,  3.54s/it] 84%|█████████████████████████████████████████████████████████████████████████████████████████████████▏                 | 169/200 [10:45<01:48,  3.49s/it] 85%|█████████████████████████████████████████████████████████████████████████████████████████████████▊                 | 170/200 [10:49<01:46,  3.53s/it] 86%|██████████████████████████████████████████████████████████████████████████████████████████████████▎                | 171/200 [10:52<01:42,  3.52s/it] 86%|██████████████████████████████████████████████████████████████████████████████████████████████████▉                | 172/200 [10:56<01:37,  3.47s/it] 86%|███████████████████████████████████████████████████████████████████████████████████████████████████▍               | 173/200 [10:59<01:33,  3.47s/it] 87%|████████████████████████████████████████████████████████████████████████████████████████████████████               | 174/200 [11:03<01:30,  3.49s/it] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████▋              | 175/200 [11:06<01:28,  3.52s/it] 88%|█████████████████████████████████████████████████████████████████████████████████████████████████████▏             | 176/200 [11:10<01:25,  3.56s/it] 88%|█████████████████████████████████████████████████████████████████████████████████████████████████████▊             | 177/200 [11:13<01:20,  3.50s/it] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████▎            | 178/200 [11:17<01:18,  3.57s/it] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████▉            | 179/200 [11:20<01:13,  3.49s/it] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████▌           | 180/200 [11:24<01:11,  3.55s/it]                                                                                                                                                          {'loss': 2.2623, 'grad_norm': 1.5097335577011108, 'learning_rate': 2.1e-05, 'epoch': 0.08}
 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████▌           | 180/200 [11:24<01:11,  3.55s/it] 90%|████████████████████████████████████████████████████████████████████████████████████████████████████████           | 181/200 [11:28<01:10,  3.72s/it] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████▋          | 182/200 [11:32<01:06,  3.69s/it] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▏         | 183/200 [11:35<01:02,  3.66s/it] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▊         | 184/200 [11:39<00:57,  3.58s/it] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▍        | 185/200 [11:42<00:53,  3.59s/it] 93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▉        | 186/200 [11:46<00:49,  3.56s/it] 94%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 187/200 [11:49<00:45,  3.51s/it] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████       | 188/200 [11:53<00:41,  3.45s/it] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▋      | 189/200 [11:56<00:37,  3.38s/it] 95%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▎     | 190/200 [11:59<00:34,  3.40s/it] 96%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▊     | 191/200 [12:03<00:32,  3.60s/it] 96%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▍    | 192/200 [12:07<00:28,  3.52s/it] 96%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▉    | 193/200 [12:10<00:24,  3.50s/it] 97%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌   | 194/200 [12:14<00:21,  3.58s/it] 98%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏  | 195/200 [12:17<00:17,  3.56s/it] 98%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋  | 196/200 [12:21<00:14,  3.73s/it] 98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎ | 197/200 [12:25<00:11,  3.70s/it] 99%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊ | 198/200 [12:29<00:07,  3.66s/it]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍| 199/200 [12:33<00:03,  3.71s/it]100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [12:36<00:00,  3.65s/it]                                                                                                                                                          {'loss': 2.3781, 'grad_norm': 2.1315088272094727, 'learning_rate': 1.0000000000000002e-06, 'epoch': 0.09}
100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [12:36<00:00,  3.65s/it]                                                                                                                                                          {'train_runtime': 757.4619, 'train_samples_per_second': 2.112, 'train_steps_per_second': 0.264, 'train_loss': 1.9655565738677978, 'epoch': 0.09}
100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [12:37<00:00,  3.65s/it]100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [12:37<00:00,  3.79s/it]
saved: /workspace/adapters/qlora_run32
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:02<00:06,  2.02s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:04<00:04,  2.30s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:07<00:02,  2.45s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:07<00:02,  2.38s/it]
Traceback (most recent call last):
  File "/workspace/run_cycle.py", line 169, in <module>
    main()
  File "/workspace/run_cycle.py", line 151, in main
    base2 = load_bnb_model()
            ^^^^^^^^^^^^^^^^
  File "/workspace/run_cycle.py", line 48, in load_bnb_model
    model = AutoModelForCausalLM.from_pretrained(BASE_MODEL, quantization_config=bnb, device_map="auto")
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/models/auto/auto_factory.py", line 604, in from_pretrained
    return model_class.from_pretrained(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 277, in _wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 5048, in from_pretrained
    ) = cls._load_pretrained_model(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 5468, in _load_pretrained_model
    _error_msgs, disk_offload_index = load_shard_file(args)
                                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 843, in load_shard_file
    disk_offload_index = _load_state_dict_into_meta_model(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/utils/_contextlib.py", line 120, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 748, in _load_state_dict_into_meta_model
    param = param[...]
            ~~~~~^^^^^
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.02 GiB. GPU 0 has a total capacity of 15.48 GiB of which 936.88 MiB is free. Including non-PyTorch memory, this process has 9.85 GiB memory in use. Process 26893 has 4.70 GiB memory in use. Of the allocated memory 9.38 GiB is allocated by PyTorch, and 319.94 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
Traceback (most recent call last):
  File "/workspace/orchestrate_cycle.py", line 404, in <module>
    main()
  File "/workspace/orchestrate_cycle.py", line 369, in main
    subprocess.run(["python3", str(ROOT / "run_cycle.py")], check=True, env=env_train)
  File "/usr/lib/python3.12/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['python3', '/workspace/run_cycle.py']' returned non-zero exit status 1.
[2025-12-27T06:23:51+00:00] RUN: CHOOSE_MODE=loss FORCE_CHOICE= RANDOM_SEED=
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:02<00:07,  2.66s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:05<00:05,  2.57s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:07<00:02,  2.27s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:08<00:00,  1.97s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:08<00:00,  2.15s/it]
Some parameters are on the meta device because they were offloaded to the cpu.
MODE: loss
ADAPTER: /workspace/adapters/qlora_run36
LOSSES: {'A': 2.587486110627651, 'B': 2.462151175364852, 'C': 3.248752538114786}
CHOICE: B
WROTE: /workspace/choice.txt
orchestrator: cycle_next = 37 | choice = B | mode = loss
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:06<00:18,  6.29s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:10<00:09,  4.94s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:14<00:04,  4.74s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:19<00:00,  4.71s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:19<00:00,  4.86s/it]
Map:   0%|                                                                                                               | 0/28107 [00:00<?, ? examples/s]Map:   0%|▏                                                                                                    | 58/28107 [00:00<00:54, 512.84 examples/s]Map:   1%|▌                                                                                                   | 156/28107 [00:00<00:36, 772.38 examples/s]Map:   3%|██▋                                                                                                | 747/28107 [00:00<00:08, 3045.48 examples/s]Map:   5%|████▊                                                                                             | 1381/28107 [00:00<00:06, 4143.37 examples/s]Map:   7%|██████▌                                                                                           | 1889/28107 [00:00<00:06, 3798.72 examples/s]Map:   9%|████████▍                                                                                         | 2408/28107 [00:00<00:06, 4208.75 examples/s]Map:  10%|██████████                                                                                        | 2898/28107 [00:00<00:05, 4410.79 examples/s]Map:  12%|███████████▊                                                                                      | 3377/28107 [00:00<00:05, 4392.70 examples/s]Map:  14%|█████████████▉                                                                                    | 4000/28107 [00:00<00:04, 4881.98 examples/s]Map:  16%|███████████████▊                                                                                  | 4545/28107 [00:01<00:06, 3707.05 examples/s]Map:  18%|█████████████████▍                                                                                | 5000/28107 [00:01<00:10, 2225.14 examples/s]Map:  20%|███████████████████▏                                                                              | 5514/28107 [00:01<00:08, 2691.14 examples/s]Map:  22%|█████████████████████▌                                                                            | 6180/28107 [00:01<00:06, 3264.48 examples/s]Map:  24%|███████████████████████▍                                                                          | 6734/28107 [00:02<00:06, 3095.74 examples/s]Map:  27%|██████████████████████████                                                                        | 7487/28107 [00:02<00:05, 3953.51 examples/s]Map:  28%|███████████████████████████▉                                                                      | 8000/28107 [00:02<00:04, 4053.36 examples/s]Map:  30%|█████████████████████████████▊                                                                    | 8533/28107 [00:02<00:04, 4345.29 examples/s]Map:  32%|███████████████████████████████▋                                                                  | 9071/28107 [00:02<00:04, 4597.65 examples/s]Map:  34%|█████████████████████████████████▋                                                                | 9657/28107 [00:02<00:05, 3660.40 examples/s]Map:  36%|██████████████████████████████████▉                                                              | 10117/28107 [00:03<00:08, 2186.73 examples/s]Map:  38%|█████████████████████████████████████▏                                                           | 10789/28107 [00:03<00:06, 2861.49 examples/s]Map:  40%|██████████████████████████████████████▊                                                          | 11264/28107 [00:03<00:05, 2933.51 examples/s]Map:  42%|████████████████████████████████████████▋                                                        | 11786/28107 [00:03<00:04, 3361.29 examples/s]Map:  45%|███████████████████████████████████████████▌                                                     | 12611/28107 [00:03<00:03, 4391.22 examples/s]Map:  48%|██████████████████████████████████████████████▎                                                  | 13432/28107 [00:03<00:03, 3824.68 examples/s]Map:  50%|████████████████████████████████████████████████▊                                                | 14158/28107 [00:04<00:03, 4147.11 examples/s]Map:  52%|██████████████████████████████████████████████████▊                                              | 14722/28107 [00:04<00:04, 3217.23 examples/s]Map:  54%|████████████████████████████████████████████████████▋                                            | 15268/28107 [00:04<00:05, 2509.70 examples/s]Map:  57%|██████████████████████████████████████████████████████▉                                          | 15925/28107 [00:04<00:03, 3106.36 examples/s]Map:  58%|████████████████████████████████████████████████████████▌                                        | 16374/28107 [00:04<00:03, 3345.36 examples/s]Map:  60%|██████████████████████████████████████████████████████████▎                                      | 16880/28107 [00:05<00:03, 3350.46 examples/s]Map:  63%|████████████████████████████████████████████████████████████▋                                    | 17571/28107 [00:05<00:02, 4078.22 examples/s]Map:  66%|███████████████████████████████████████████████████████████████▌                                 | 18411/28107 [00:05<00:02, 3425.51 examples/s]Map:  69%|██████████████████████████████████████████████████████████████████▋                              | 19309/28107 [00:05<00:01, 4422.73 examples/s]Map:  71%|████████████████████████████████████████████████████████████████████▌                            | 19880/28107 [00:05<00:01, 4246.26 examples/s]Map:  73%|██████████████████████████████████████████████████████████████████████▍                          | 20406/28107 [00:05<00:02, 3782.67 examples/s]Map:  74%|████████████████████████████████████████████████████████████████████████                         | 20867/28107 [00:05<00:01, 3948.88 examples/s]Map:  77%|██████████████████████████████████████████████████████████████████████████▍                      | 21584/28107 [00:06<00:01, 4670.14 examples/s]Map:  79%|████████████████████████████████████████████████████████████████████████████▍                    | 22133/28107 [00:06<00:01, 4806.56 examples/s]Map:  82%|███████████████████████████████████████████████████████████████████████████████▎                 | 22990/28107 [00:06<00:01, 5111.25 examples/s]Map:  84%|█████████████████████████████████████████████████████████████████████████████████▍               | 23584/28107 [00:06<00:01, 3881.16 examples/s]Map:  87%|████████████████████████████████████████████████████████████████████████████████████             | 24351/28107 [00:06<00:00, 4648.37 examples/s]Map:  89%|█████████████████████████████████████████████████████████████████████████████████████▉           | 24903/28107 [00:06<00:00, 4834.89 examples/s]Map:  91%|███████████████████████████████████████████████████████████████████████████████████████▊         | 25460/28107 [00:07<00:00, 2722.06 examples/s]Map:  92%|█████████████████████████████████████████████████████████████████████████████████████████▍       | 25914/28107 [00:07<00:01, 2035.10 examples/s]Map:  94%|███████████████████████████████████████████████████████████████████████████████████████████▏     | 26407/28107 [00:07<00:00, 2418.72 examples/s]Map:  97%|██████████████████████████████████████████████████████████████████████████████████████████████▍  | 27380/28107 [00:07<00:00, 3583.25 examples/s]Map: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 28107/28107 [00:08<00:00, 3699.46 examples/s]Map: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 28107/28107 [00:08<00:00, 3511.66 examples/s]
TRAIN: cycle37  choice=B  data=/workspace/clean_data_norm/latest/B/dialog.txt  prev=/workspace/adapters/qlora_run36  exclude=2000
  0%|                                                                                                                             | 0/200 [00:00<?, ?it/s]  0%|▌                                                                                                                    | 1/200 [00:05<16:55,  5.10s/it]  1%|█▏                                                                                                                   | 2/200 [00:08<14:24,  4.36s/it]  2%|█▊                                                                                                                   | 3/200 [00:12<13:40,  4.17s/it]  2%|██▎                                                                                                                  | 4/200 [00:16<12:55,  3.96s/it]  2%|██▉                                                                                                                  | 5/200 [00:21<14:28,  4.45s/it]  3%|███▌                                                                                                                 | 6/200 [00:25<13:59,  4.33s/it]  4%|████                                                                                                                 | 7/200 [00:29<13:30,  4.20s/it]  4%|████▋                                                                                                                | 8/200 [00:33<13:06,  4.09s/it]  4%|█████▎                                                                                                               | 9/200 [00:37<12:46,  4.02s/it]  5%|█████▊                                                                                                              | 10/200 [00:41<12:26,  3.93s/it]  6%|██████▍                                                                                                             | 11/200 [00:45<12:28,  3.96s/it]  6%|██████▉                                                                                                             | 12/200 [00:49<12:31,  4.00s/it]  6%|███████▌                                                                                                            | 13/200 [00:53<12:22,  3.97s/it]  7%|████████                                                                                                            | 14/200 [00:56<11:48,  3.81s/it]  8%|████████▋                                                                                                           | 15/200 [01:01<12:51,  4.17s/it]  8%|█████████▎                                                                                                          | 16/200 [01:05<12:02,  3.93s/it]  8%|█████████▊                                                                                                          | 17/200 [01:08<11:46,  3.86s/it]  9%|██████████▍                                                                                                         | 18/200 [01:12<11:31,  3.80s/it] 10%|███████████                                                                                                         | 19/200 [01:16<11:11,  3.71s/it] 10%|███████████▌                                                                                                        | 20/200 [01:19<11:04,  3.69s/it]                                                                                                                                                          {'loss': 0.1338, 'grad_norm': 3.091718912124634, 'learning_rate': 0.000181, 'epoch': 0.01}
 10%|███████████▌                                                                                                        | 20/200 [01:19<11:04,  3.69s/it] 10%|████████████▏                                                                                                       | 21/200 [01:23<11:00,  3.69s/it] 11%|████████████▊                                                                                                       | 22/200 [01:27<11:28,  3.87s/it] 12%|█████████████▎                                                                                                      | 23/200 [01:31<11:19,  3.84s/it] 12%|█████████████▉                                                                                                      | 24/200 [01:35<11:11,  3.81s/it] 12%|██████████████▌                                                                                                     | 25/200 [01:39<11:11,  3.84s/it] 13%|███████████████                                                                                                     | 26/200 [01:43<11:14,  3.88s/it] 14%|███████████████▋                                                                                                    | 27/200 [01:46<10:52,  3.77s/it] 14%|████████████████▏                                                                                                   | 28/200 [01:50<10:50,  3.78s/it] 14%|████████████████▊                                                                                                   | 29/200 [01:54<10:57,  3.85s/it] 15%|█████████████████▍                                                                                                  | 30/200 [01:58<10:50,  3.83s/it] 16%|█████████████████▉                                                                                                  | 31/200 [02:02<10:57,  3.89s/it] 16%|██████████████████▌                                                                                                 | 32/200 [02:06<10:52,  3.88s/it] 16%|███████████████████▏                                                                                                | 33/200 [02:09<10:49,  3.89s/it] 17%|███████████████████▋                                                                                                | 34/200 [02:14<11:38,  4.21s/it] 18%|████████████████████▎                                                                                               | 35/200 [02:18<11:07,  4.04s/it] 18%|████████████████████▉                                                                                               | 36/200 [02:22<10:46,  3.94s/it] 18%|█████████████████████▍                                                                                              | 37/200 [02:25<10:19,  3.80s/it] 19%|██████████████████████                                                                                              | 38/200 [02:29<09:53,  3.67s/it] 20%|██████████████████████▌                                                                                             | 39/200 [02:32<09:55,  3.70s/it] 20%|███████████████████████▏                                                                                            | 40/200 [02:36<09:58,  3.74s/it]                                                                                                                                                          {'loss': 0.1354, 'grad_norm': 2.8206169605255127, 'learning_rate': 0.000161, 'epoch': 0.01}
 20%|███████████████████████▏                                                                                            | 40/200 [02:36<09:58,  3.74s/it] 20%|███████████████████████▊                                                                                            | 41/200 [02:40<09:58,  3.77s/it] 21%|████████████████████████▎                                                                                           | 42/200 [02:44<10:18,  3.92s/it] 22%|████████████████████████▉                                                                                           | 43/200 [02:48<10:08,  3.88s/it] 22%|█████████████████████████▌                                                                                          | 44/200 [02:52<10:09,  3.91s/it] 22%|██████████████████████████                                                                                          | 45/200 [02:56<09:52,  3.82s/it] 23%|██████████████████████████▋                                                                                         | 46/200 [03:00<09:57,  3.88s/it] 24%|███████████████████████████▎                                                                                        | 47/200 [03:04<09:52,  3.88s/it] 24%|███████████████████████████▊                                                                                        | 48/200 [03:07<09:40,  3.82s/it] 24%|████████████████████████████▍                                                                                       | 49/200 [03:11<09:27,  3.76s/it] 25%|█████████████████████████████                                                                                       | 50/200 [03:15<09:31,  3.81s/it] 26%|█████████████████████████████▌                                                                                      | 51/200 [03:19<09:45,  3.93s/it] 26%|██████████████████████████████▏                                                                                     | 52/200 [03:23<09:57,  4.04s/it] 26%|██████████████████████████████▋                                                                                     | 53/200 [03:27<09:33,  3.90s/it] 27%|███████████████████████████████▎                                                                                    | 54/200 [03:30<09:16,  3.81s/it] 28%|███████████████████████████████▉                                                                                    | 55/200 [03:34<09:19,  3.86s/it] 28%|████████████████████████████████▍                                                                                   | 56/200 [03:38<09:18,  3.88s/it] 28%|█████████████████████████████████                                                                                   | 57/200 [03:43<09:44,  4.09s/it] 29%|█████████████████████████████████▋                                                                                  | 58/200 [03:48<10:24,  4.40s/it] 30%|██████████████████████████████████▏                                                                                 | 59/200 [03:52<09:47,  4.17s/it] 30%|██████████████████████████████████▊                                                                                 | 60/200 [03:55<09:17,  3.98s/it]                                                                                                                                                          {'loss': 0.1523, 'grad_norm': 2.756152868270874, 'learning_rate': 0.000141, 'epoch': 0.02}
 30%|██████████████████████████████████▊                                                                                 | 60/200 [03:55<09:17,  3.98s/it] 30%|███████████████████████████████████▍                                                                                | 61/200 [03:59<09:11,  3.97s/it] 31%|███████████████████████████████████▉                                                                                | 62/200 [04:03<08:58,  3.91s/it] 32%|████████████████████████████████████▌                                                                               | 63/200 [04:07<09:05,  3.98s/it] 32%|█████████████████████████████████████                                                                               | 64/200 [04:11<08:52,  3.91s/it] 32%|█████████████████████████████████████▋                                                                              | 65/200 [04:15<08:56,  3.97s/it] 33%|██████████████████████████████████████▎                                                                             | 66/200 [04:19<08:42,  3.90s/it] 34%|██████████████████████████████████████▊                                                                             | 67/200 [04:24<09:23,  4.24s/it] 34%|███████████████████████████████████████▍                                                                            | 68/200 [04:27<08:52,  4.03s/it] 34%|████████████████████████████████████████                                                                            | 69/200 [04:31<08:52,  4.06s/it] 35%|████████████████████████████████████████▌                                                                           | 70/200 [04:35<08:36,  3.98s/it] 36%|█████████████████████████████████████████▏                                                                          | 71/200 [04:39<08:30,  3.95s/it] 36%|█████████████████████████████████████████▊                                                                          | 72/200 [04:43<08:25,  3.95s/it] 36%|██████████████████████████████████████████▎                                                                         | 73/200 [04:47<08:18,  3.92s/it] 37%|██████████████████████████████████████████▉                                                                         | 74/200 [04:51<08:03,  3.84s/it] 38%|███████████████████████████████████████████▌                                                                        | 75/200 [04:54<07:43,  3.71s/it] 38%|████████████████████████████████████████████                                                                        | 76/200 [04:58<07:51,  3.81s/it] 38%|████████████████████████████████████████████▋                                                                       | 77/200 [05:02<07:47,  3.80s/it] 39%|█████████████████████████████████████████████▏                                                                      | 78/200 [05:05<07:40,  3.78s/it] 40%|█████████████████████████████████████████████▊                                                                      | 79/200 [05:09<07:44,  3.84s/it] 40%|██████████████████████████████████████████████▍                                                                     | 80/200 [05:14<07:50,  3.92s/it]                                                                                                                                                          {'loss': 0.1858, 'grad_norm': 5.108291149139404, 'learning_rate': 0.000121, 'epoch': 0.02}
 40%|██████████████████████████████████████████████▍                                                                     | 80/200 [05:14<07:50,  3.92s/it] 40%|██████████████████████████████████████████████▉                                                                     | 81/200 [05:19<08:33,  4.31s/it] 41%|███████████████████████████████████████████████▌                                                                    | 82/200 [05:22<07:59,  4.06s/it] 42%|████████████████████████████████████████████████▏                                                                   | 83/200 [05:26<07:43,  3.96s/it] 42%|████████████████████████████████████████████████▋                                                                   | 84/200 [05:30<07:33,  3.91s/it] 42%|█████████████████████████████████████████████████▎                                                                  | 85/200 [05:34<07:32,  3.94s/it] 43%|█████████████████████████████████████████████████▉                                                                  | 86/200 [05:38<07:21,  3.88s/it] 44%|██████████████████████████████████████████████████▍                                                                 | 87/200 [05:41<07:07,  3.78s/it] 44%|███████████████████████████████████████████████████                                                                 | 88/200 [05:45<07:08,  3.83s/it] 44%|███████████████████████████████████████████████████▌                                                                | 89/200 [05:49<06:58,  3.77s/it] 45%|████████████████████████████████████████████████████▏                                                               | 90/200 [05:53<07:02,  3.84s/it] 46%|████████████████████████████████████████████████████▊                                                               | 91/200 [05:56<06:58,  3.84s/it] 46%|█████████████████████████████████████████████████████▎                                                              | 92/200 [06:00<06:40,  3.71s/it] 46%|█████████████████████████████████████████████████████▉                                                              | 93/200 [06:03<06:28,  3.63s/it] 47%|██████████████████████████████████████████████████████▌                                                             | 94/200 [06:07<06:15,  3.54s/it] 48%|███████████████████████████████████████████████████████                                                             | 95/200 [06:10<06:13,  3.56s/it] 48%|███████████████████████████████████████████████████████▋                                                            | 96/200 [06:14<06:01,  3.48s/it] 48%|████████████████████████████████████████████████████████▎                                                           | 97/200 [06:17<05:53,  3.43s/it] 49%|████████████████████████████████████████████████████████▊                                                           | 98/200 [06:20<05:53,  3.47s/it] 50%|█████████████████████████████████████████████████████████▍                                                          | 99/200 [06:24<05:56,  3.53s/it] 50%|█████████████████████████████████████████████████████████▌                                                         | 100/200 [06:28<05:55,  3.55s/it]                                                                                                                                                          {'loss': 0.2236, 'grad_norm': 3.0107390880584717, 'learning_rate': 0.000101, 'epoch': 0.03}
 50%|█████████████████████████████████████████████████████████▌                                                         | 100/200 [06:28<05:55,  3.55s/it] 50%|██████████████████████████████████████████████████████████                                                         | 101/200 [06:31<05:42,  3.46s/it] 51%|██████████████████████████████████████████████████████████▋                                                        | 102/200 [06:34<05:31,  3.38s/it] 52%|███████████████████████████████████████████████████████████▏                                                       | 103/200 [06:38<05:30,  3.40s/it] 52%|███████████████████████████████████████████████████████████▊                                                       | 104/200 [06:41<05:29,  3.43s/it] 52%|████████████████████████████████████████████████████████████▍                                                      | 105/200 [06:45<05:31,  3.48s/it] 53%|████████████████████████████████████████████████████████████▉                                                      | 106/200 [06:48<05:25,  3.47s/it] 54%|█████████████████████████████████████████████████████████████▌                                                     | 107/200 [06:52<05:19,  3.44s/it] 54%|██████████████████████████████████████████████████████████████                                                     | 108/200 [06:55<05:19,  3.47s/it] 55%|██████████████████████████████████████████████████████████████▋                                                    | 109/200 [06:58<05:10,  3.41s/it] 55%|███████████████████████████████████████████████████████████████▎                                                   | 110/200 [07:02<05:03,  3.37s/it] 56%|███████████████████████████████████████████████████████████████▊                                                   | 111/200 [07:05<05:01,  3.38s/it] 56%|████████████████████████████████████████████████████████████████▍                                                  | 112/200 [07:09<05:11,  3.54s/it] 56%|████████████████████████████████████████████████████████████████▉                                                  | 113/200 [07:13<05:09,  3.56s/it] 57%|█████████████████████████████████████████████████████████████████▌                                                 | 114/200 [07:16<05:03,  3.52s/it] 57%|██████████████████████████████████████████████████████████████████▏                                                | 115/200 [07:20<05:00,  3.53s/it] 58%|██████████████████████████████████████████████████████████████████▋                                                | 116/200 [07:23<05:03,  3.61s/it] 58%|███████████████████████████████████████████████████████████████████▎                                               | 117/200 [07:27<04:51,  3.52s/it] 59%|███████████████████████████████████████████████████████████████████▊                                               | 118/200 [07:30<04:47,  3.51s/it] 60%|████████████████████████████████████████████████████████████████████▍                                              | 119/200 [07:34<04:41,  3.48s/it] 60%|█████████████████████████████████████████████████████████████████████                                              | 120/200 [07:37<04:35,  3.44s/it]                                                                                                                                                          {'loss': 0.3135, 'grad_norm': 4.948784828186035, 'learning_rate': 8.1e-05, 'epoch': 0.03}
 60%|█████████████████████████████████████████████████████████████████████                                              | 120/200 [07:37<04:35,  3.44s/it] 60%|█████████████████████████████████████████████████████████████████████▌                                             | 121/200 [07:40<04:29,  3.41s/it] 61%|██████████████████████████████████████████████████████████████████████▏                                            | 122/200 [07:44<04:29,  3.46s/it] 62%|██████████████████████████████████████████████████████████████████████▋                                            | 123/200 [07:47<04:25,  3.45s/it] 62%|███████████████████████████████████████████████████████████████████████▎                                           | 124/200 [07:51<04:21,  3.44s/it] 62%|███████████████████████████████████████████████████████████████████████▉                                           | 125/200 [07:54<04:16,  3.42s/it] 63%|████████████████████████████████████████████████████████████████████████▍                                          | 126/200 [07:58<04:17,  3.48s/it] 64%|█████████████████████████████████████████████████████████████████████████                                          | 127/200 [08:01<04:16,  3.51s/it] 64%|█████████████████████████████████████████████████████████████████████████▌                                         | 128/200 [08:05<04:10,  3.48s/it] 64%|██████████████████████████████████████████████████████████████████████████▏                                        | 129/200 [08:08<04:03,  3.43s/it] 65%|██████████████████████████████████████████████████████████████████████████▊                                        | 130/200 [08:11<03:56,  3.38s/it] 66%|███████████████████████████████████████████████████████████████████████████▎                                       | 131/200 [08:15<03:56,  3.43s/it] 66%|███████████████████████████████████████████████████████████████████████████▉                                       | 132/200 [08:18<03:58,  3.51s/it] 66%|████████████████████████████████████████████████████████████████████████████▍                                      | 133/200 [08:22<03:55,  3.51s/it] 67%|█████████████████████████████████████████████████████████████████████████████                                      | 134/200 [08:25<03:48,  3.46s/it] 68%|█████████████████████████████████████████████████████████████████████████████▋                                     | 135/200 [08:29<03:48,  3.52s/it] 68%|██████████████████████████████████████████████████████████████████████████████▏                                    | 136/200 [08:33<03:45,  3.53s/it] 68%|██████████████████████████████████████████████████████████████████████████████▊                                    | 137/200 [08:36<03:41,  3.52s/it] 69%|███████████████████████████████████████████████████████████████████████████████▎                                   | 138/200 [08:39<03:33,  3.44s/it] 70%|███████████████████████████████████████████████████████████████████████████████▉                                   | 139/200 [08:42<03:24,  3.35s/it] 70%|████████████████████████████████████████████████████████████████████████████████▌                                  | 140/200 [08:46<03:25,  3.43s/it]                                                                                                                                                          {'loss': 0.4019, 'grad_norm': 3.613298177719116, 'learning_rate': 6.1e-05, 'epoch': 0.04}
 70%|████████████████████████████████████████████████████████████████████████████████▌                                  | 140/200 [08:46<03:25,  3.43s/it] 70%|█████████████████████████████████████████████████████████████████████████████████                                  | 141/200 [08:49<03:21,  3.42s/it] 71%|█████████████████████████████████████████████████████████████████████████████████▋                                 | 142/200 [08:53<03:16,  3.39s/it] 72%|██████████████████████████████████████████████████████████████████████████████████▏                                | 143/200 [08:56<03:13,  3.39s/it] 72%|██████████████████████████████████████████████████████████████████████████████████▊                                | 144/200 [09:00<03:11,  3.41s/it] 72%|███████████████████████████████████████████████████████████████████████████████████▍                               | 145/200 [09:03<03:06,  3.38s/it] 73%|███████████████████████████████████████████████████████████████████████████████████▉                               | 146/200 [09:07<03:09,  3.51s/it] 74%|████████████████████████████████████████████████████████████████████████████████████▌                              | 147/200 [09:10<03:02,  3.45s/it] 74%|█████████████████████████████████████████████████████████████████████████████████████                              | 148/200 [09:14<03:04,  3.56s/it] 74%|█████████████████████████████████████████████████████████████████████████████████████▋                             | 149/200 [09:17<03:01,  3.57s/it] 75%|██████████████████████████████████████████████████████████████████████████████████████▎                            | 150/200 [09:21<02:57,  3.54s/it] 76%|██████████████████████████████████████████████████████████████████████████████████████▊                            | 151/200 [09:24<02:50,  3.47s/it] 76%|███████████████████████████████████████████████████████████████████████████████████████▍                           | 152/200 [09:27<02:43,  3.41s/it] 76%|███████████████████████████████████████████████████████████████████████████████████████▉                           | 153/200 [09:31<02:43,  3.47s/it] 77%|████████████████████████████████████████████████████████████████████████████████████████▌                          | 154/200 [09:34<02:36,  3.40s/it] 78%|█████████████████████████████████████████████████████████████████████████████████████████▏                         | 155/200 [09:38<02:34,  3.43s/it] 78%|█████████████████████████████████████████████████████████████████████████████████████████▋                         | 156/200 [09:41<02:27,  3.36s/it] 78%|██████████████████████████████████████████████████████████████████████████████████████████▎                        | 157/200 [09:44<02:25,  3.38s/it] 79%|██████████████████████████████████████████████████████████████████████████████████████████▊                        | 158/200 [09:48<02:20,  3.35s/it] 80%|███████████████████████████████████████████████████████████████████████████████████████████▍                       | 159/200 [09:51<02:18,  3.37s/it] 80%|████████████████████████████████████████████████████████████████████████████████████████████                       | 160/200 [09:55<02:18,  3.46s/it]                                                                                                                                                          {'loss': 0.6521, 'grad_norm': 4.186509132385254, 'learning_rate': 4.1e-05, 'epoch': 0.05}
 80%|████████████████████████████████████████████████████████████████████████████████████████████                       | 160/200 [09:55<02:18,  3.46s/it] 80%|████████████████████████████████████████████████████████████████████████████████████████████▌                      | 161/200 [09:58<02:14,  3.44s/it] 81%|█████████████████████████████████████████████████████████████████████████████████████████████▏                     | 162/200 [10:02<02:11,  3.46s/it] 82%|█████████████████████████████████████████████████████████████████████████████████████████████▋                     | 163/200 [10:05<02:09,  3.50s/it] 82%|██████████████████████████████████████████████████████████████████████████████████████████████▎                    | 164/200 [10:09<02:07,  3.53s/it] 82%|██████████████████████████████████████████████████████████████████████████████████████████████▉                    | 165/200 [10:12<02:00,  3.44s/it] 83%|███████████████████████████████████████████████████████████████████████████████████████████████▍                   | 166/200 [10:15<01:55,  3.39s/it] 84%|████████████████████████████████████████████████████████████████████████████████████████████████                   | 167/200 [10:19<01:52,  3.42s/it] 84%|████████████████████████████████████████████████████████████████████████████████████████████████▌                  | 168/200 [10:22<01:48,  3.39s/it] 84%|█████████████████████████████████████████████████████████████████████████████████████████████████▏                 | 169/200 [10:25<01:43,  3.33s/it] 85%|█████████████████████████████████████████████████████████████████████████████████████████████████▊                 | 170/200 [10:29<01:41,  3.37s/it] 86%|██████████████████████████████████████████████████████████████████████████████████████████████████▎                | 171/200 [10:33<01:39,  3.45s/it] 86%|██████████████████████████████████████████████████████████████████████████████████████████████████▉                | 172/200 [10:36<01:35,  3.42s/it] 86%|███████████████████████████████████████████████████████████████████████████████████████████████████▍               | 173/200 [10:39<01:31,  3.40s/it] 87%|████████████████████████████████████████████████████████████████████████████████████████████████████               | 174/200 [10:43<01:30,  3.50s/it] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████▋              | 175/200 [10:46<01:27,  3.51s/it] 88%|█████████████████████████████████████████████████████████████████████████████████████████████████████▏             | 176/200 [10:50<01:23,  3.46s/it] 88%|█████████████████████████████████████████████████████████████████████████████████████████████████████▊             | 177/200 [10:53<01:18,  3.42s/it] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████▎            | 178/200 [10:57<01:19,  3.62s/it] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████▉            | 179/200 [11:01<01:14,  3.54s/it] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████▌           | 180/200 [11:04<01:09,  3.49s/it]                                                                                                                                                          {'loss': 1.066, 'grad_norm': 6.208493232727051, 'learning_rate': 2.1e-05, 'epoch': 0.05}
 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████▌           | 180/200 [11:04<01:09,  3.49s/it] 90%|████████████████████████████████████████████████████████████████████████████████████████████████████████           | 181/200 [11:08<01:06,  3.51s/it] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████▋          | 182/200 [11:11<01:03,  3.53s/it] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▏         | 183/200 [11:14<00:59,  3.48s/it] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▊         | 184/200 [11:18<00:54,  3.42s/it] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▍        | 185/200 [11:21<00:51,  3.42s/it] 93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▉        | 186/200 [11:25<00:47,  3.41s/it] 94%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 187/200 [11:28<00:43,  3.38s/it] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████       | 188/200 [11:31<00:40,  3.36s/it] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▋      | 189/200 [11:35<00:37,  3.40s/it] 95%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▎     | 190/200 [11:38<00:34,  3.41s/it] 96%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▊     | 191/200 [11:42<00:30,  3.42s/it] 96%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▍    | 192/200 [11:45<00:27,  3.39s/it] 96%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▉    | 193/200 [11:48<00:23,  3.34s/it] 97%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌   | 194/200 [11:51<00:20,  3.35s/it] 98%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏  | 195/200 [11:55<00:16,  3.40s/it] 98%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋  | 196/200 [11:58<00:13,  3.36s/it] 98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎ | 197/200 [12:02<00:10,  3.45s/it] 99%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊ | 198/200 [12:06<00:07,  3.51s/it]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍| 199/200 [12:09<00:03,  3.51s/it]100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [12:12<00:00,  3.49s/it]                                                                                                                                                          {'loss': 1.7035, 'grad_norm': 6.540396690368652, 'learning_rate': 1.0000000000000002e-06, 'epoch': 0.06}
100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [12:12<00:00,  3.49s/it]                                                                                                                                                          {'train_runtime': 733.8519, 'train_samples_per_second': 2.18, 'train_steps_per_second': 0.273, 'train_loss': 0.4967900550365448, 'epoch': 0.06}
100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [12:13<00:00,  3.49s/it]100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [12:13<00:00,  3.67s/it]
saved: /workspace/adapters/qlora_run37
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:02<00:06,  2.14s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:04<00:04,  2.39s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:07<00:02,  2.49s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:07<00:02,  2.44s/it]
Traceback (most recent call last):
  File "/workspace/run_cycle.py", line 169, in <module>
    main()
  File "/workspace/run_cycle.py", line 151, in main
    base2 = load_bnb_model()
            ^^^^^^^^^^^^^^^^
  File "/workspace/run_cycle.py", line 48, in load_bnb_model
    model = AutoModelForCausalLM.from_pretrained(BASE_MODEL, quantization_config=bnb, device_map="auto")
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/models/auto/auto_factory.py", line 604, in from_pretrained
    return model_class.from_pretrained(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 277, in _wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 5048, in from_pretrained
    ) = cls._load_pretrained_model(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 5468, in _load_pretrained_model
    _error_msgs, disk_offload_index = load_shard_file(args)
                                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 843, in load_shard_file
    disk_offload_index = _load_state_dict_into_meta_model(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/utils/_contextlib.py", line 120, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 748, in _load_state_dict_into_meta_model
    param = param[...]
            ~~~~~^^^^^
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.02 GiB. GPU 0 has a total capacity of 15.48 GiB of which 532.94 MiB is free. Process 27106 has 5.12 GiB memory in use. Including non-PyTorch memory, this process has 9.83 GiB memory in use. Of the allocated memory 9.38 GiB is allocated by PyTorch, and 295.86 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
Traceback (most recent call last):
  File "/workspace/orchestrate_cycle.py", line 404, in <module>
    main()
  File "/workspace/orchestrate_cycle.py", line 369, in main
    subprocess.run(["python3", str(ROOT / "run_cycle.py")], check=True, env=env_train)
  File "/usr/lib/python3.12/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['python3', '/workspace/run_cycle.py']' returned non-zero exit status 1.
[2025-12-27T08:06:54+00:00] ERROR rc=1 consec_fails=1
[2025-12-27T08:07:24+00:00] RUN: CHOOSE_MODE=random FORCE_CHOICE= RANDOM_SEED=12365
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:03<00:09,  3.13s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:05<00:05,  2.91s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:08<00:02,  2.95s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:10<00:00,  2.38s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:10<00:00,  2.60s/it]
Some parameters are on the meta device because they were offloaded to the cpu.
MODE: random
ADAPTER: /workspace/adapters/qlora_run37
LOSSES: {'A': 2.662859581410885, 'B': 2.537343753501773, 'C': 3.325831323862076}
CHOICE: A
WROTE: /workspace/choice.txt
orchestrator: cycle_next = 38 | choice = A | mode = random
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:02<00:07,  2.42s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:05<00:06,  3.02s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:11<00:04,  4.14s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:13<00:00,  3.30s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:13<00:00,  3.34s/it]
Map:   0%|                                                                                                               | 0/27999 [00:00<?, ? examples/s]Map:   2%|█▌                                                                                                 | 454/27999 [00:00<00:06, 4519.06 examples/s]Map:   4%|███▌                                                                                              | 1000/27999 [00:00<00:07, 3842.61 examples/s]Map:   6%|█████▊                                                                                            | 1674/27999 [00:00<00:07, 3568.91 examples/s]Map:   7%|███████▏                                                                                          | 2070/27999 [00:00<00:07, 3679.03 examples/s]Map:   9%|████████▉                                                                                         | 2537/27999 [00:00<00:06, 3961.06 examples/s]Map:  11%|██████████▌                                                                                       | 3000/27999 [00:00<00:06, 4116.35 examples/s]Map:  12%|████████████                                                                                      | 3449/27999 [00:00<00:05, 4223.92 examples/s]Map:  14%|█████████████▊                                                                                    | 3953/27999 [00:01<00:06, 3887.14 examples/s]Map:  16%|███████████████▉                                                                                  | 4565/27999 [00:01<00:05, 3949.90 examples/s]Map:  18%|█████████████████▌                                                                                | 5000/27999 [00:01<00:06, 3589.11 examples/s]Map:  19%|██████████████████▉                                                                               | 5419/27999 [00:01<00:06, 3732.68 examples/s]Map:  21%|████████████████████▋                                                                             | 5899/27999 [00:01<00:05, 4003.82 examples/s]Map:  23%|██████████████████████▍                                                                           | 6415/27999 [00:01<00:05, 3801.50 examples/s]Map:  25%|████████████████████████▎                                                                         | 6939/27999 [00:01<00:05, 3691.80 examples/s]Map:  26%|█████████████████████████▋                                                                        | 7344/27999 [00:01<00:05, 3778.21 examples/s]Map:  28%|███████████████████████████▊                                                                      | 7935/27999 [00:02<00:05, 3831.72 examples/s]Map:  30%|█████████████████████████████▍                                                                    | 8415/27999 [00:02<00:05, 3588.24 examples/s]Map:  32%|██████████████████████████████▉                                                                   | 8854/27999 [00:02<00:05, 3773.37 examples/s]Map:  33%|████████████████████████████████▌                                                                 | 9318/27999 [00:02<00:05, 3329.83 examples/s]Map:  35%|█████████████████████████████████▉                                                                | 9706/27999 [00:02<00:05, 3451.18 examples/s]Map:  37%|███████████████████████████████████▌                                                             | 10279/27999 [00:02<00:04, 3557.95 examples/s]Map:  39%|█████████████████████████████████████▊                                                           | 10920/27999 [00:02<00:04, 3417.22 examples/s]Map:  40%|███████████████████████████████████████▎                                                         | 11338/27999 [00:03<00:05, 3173.92 examples/s]Map:  42%|████████████████████████████████████████▉                                                        | 11828/27999 [00:03<00:04, 3542.22 examples/s]Map:  44%|██████████████████████████████████████████▍                                                      | 12254/27999 [00:03<00:05, 3082.36 examples/s]Map:  45%|███████████████████████████████████████████▋                                                     | 12621/27999 [00:03<00:04, 3209.26 examples/s]Map:  46%|████████████████████████████████████████████▉                                                    | 12982/27999 [00:03<00:04, 3300.98 examples/s]Map:  48%|██████████████████████████████████████████████▋                                                  | 13484/27999 [00:03<00:04, 3314.54 examples/s]Map:  50%|████████████████████████████████████████████████▍                                                | 13968/27999 [00:03<00:03, 3683.01 examples/s]Map:  51%|█████████████████████████████████████████████████▊                                               | 14361/27999 [00:03<00:03, 3743.00 examples/s]Map:  53%|███████████████████████████████████████████████████                                              | 14753/27999 [00:04<00:03, 3786.87 examples/s]Map:  54%|████████████████████████████████████████████████████▍                                            | 15153/27999 [00:04<00:03, 3842.20 examples/s]Map:  56%|██████████████████████████████████████████████████████                                           | 15600/27999 [00:04<00:03, 4019.31 examples/s]Map:  57%|███████████████████████████████████████████████████████▌                                         | 16034/27999 [00:04<00:03, 3590.88 examples/s]Map:  59%|█████████████████████████████████████████████████████████▍                                       | 16576/27999 [00:04<00:03, 3596.25 examples/s]Map:  61%|██████████████████████████████████████████████████████████▊                                      | 16959/27999 [00:04<00:03, 3651.26 examples/s]Map:  62%|████████████████████████████████████████████████████████████                                     | 17345/27999 [00:04<00:02, 3658.52 examples/s]Map:  63%|█████████████████████████████████████████████████████████████▌                                   | 17770/27999 [00:04<00:02, 3817.00 examples/s]Map:  65%|███████████████████████████████████████████████████████████████▏                                 | 18235/27999 [00:05<00:02, 3549.16 examples/s]Map:  67%|█████████████████████████████████████████████████████████████████                                | 18792/27999 [00:05<00:02, 3599.03 examples/s]Map:  69%|██████████████████████████████████████████████████████████████████▉                              | 19339/27999 [00:05<00:02, 3321.61 examples/s]Map:  71%|████████████████████████████████████████████████████████████████████▍                            | 19754/27999 [00:05<00:02, 3504.68 examples/s]Map:  72%|█████████████████████████████████████████████████████████████████████▊                           | 20150/27999 [00:05<00:02, 3219.81 examples/s]Map:  73%|███████████████████████████████████████████████████████████████████████                          | 20514/27999 [00:05<00:02, 3317.22 examples/s]Map:  75%|████████████████████████████████████████████████████████████████████████▊                        | 21000/27999 [00:05<00:01, 3615.12 examples/s]Map:  77%|██████████████████████████████████████████████████████████████████████████▊                      | 21588/27999 [00:05<00:01, 3712.87 examples/s]Map:  79%|████████████████████████████████████████████████████████████████████████████▋                    | 22131/27999 [00:06<00:01, 3398.57 examples/s]Map:  81%|██████████████████████████████████████████████████████████████████████████████▏                  | 22581/27999 [00:06<00:01, 3276.02 examples/s]Map:  82%|███████████████████████████████████████████████████████████████████████████████▋                 | 23000/27999 [00:06<00:01, 3398.58 examples/s]Map:  84%|█████████████████████████████████████████████████████████████████████████████████▉               | 23654/27999 [00:06<00:01, 3794.65 examples/s]Map:  86%|███████████████████████████████████████████████████████████████████████████████████▌             | 24103/27999 [00:06<00:00, 3959.29 examples/s]Map:  88%|█████████████████████████████████████████████████████████████████████████████████████▎           | 24638/27999 [00:06<00:00, 4310.21 examples/s]Map:  90%|███████████████████████████████████████████████████████████████████████████████████████▋         | 25325/27999 [00:06<00:00, 3930.19 examples/s]Map:  92%|█████████████████████████████████████████████████████████████████████████████████████████▌       | 25850/27999 [00:07<00:00, 3794.37 examples/s]Map:  95%|███████████████████████████████████████████████████████████████████████████████████████████▉     | 26548/27999 [00:07<00:00, 4054.07 examples/s]Map:  96%|█████████████████████████████████████████████████████████████████████████████████████████████▌   | 27000/27999 [00:07<00:00, 4069.85 examples/s]Map:  98%|███████████████████████████████████████████████████████████████████████████████████████████████▎ | 27499/27999 [00:07<00:00, 3828.23 examples/s]Map: 100%|████████████████████████████████████████████████████████████████████████████████████████████████▉| 27975/27999 [00:07<00:00, 4042.72 examples/s]Map: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 27999/27999 [00:07<00:00, 3650.20 examples/s]
TRAIN: cycle38  choice=A  data=/workspace/clean_data_norm/latest/A/science.txt  prev=/workspace/adapters/qlora_run37  exclude=2000
  0%|                                                                                                                             | 0/200 [00:00<?, ?it/s]  0%|▌                                                                                                                    | 1/200 [00:04<13:39,  4.12s/it]  1%|█▏                                                                                                                   | 2/200 [00:07<12:20,  3.74s/it]  2%|█▊                                                                                                                   | 3/200 [00:11<12:11,  3.71s/it]  2%|██▎                                                                                                                  | 4/200 [00:14<12:00,  3.68s/it]  2%|██▉                                                                                                                  | 5/200 [00:18<11:43,  3.61s/it]  3%|███▌                                                                                                                 | 6/200 [00:21<11:33,  3.57s/it]  4%|████                                                                                                                 | 7/200 [00:25<11:43,  3.65s/it]  4%|████▋                                                                                                                | 8/200 [00:29<11:24,  3.57s/it]  4%|█████▎                                                                                                               | 9/200 [00:32<10:59,  3.45s/it]  5%|█████▊                                                                                                              | 10/200 [00:35<11:04,  3.50s/it]  6%|██████▍                                                                                                             | 11/200 [00:39<11:12,  3.56s/it]  6%|██████▉                                                                                                             | 12/200 [00:43<11:17,  3.61s/it]  6%|███████▌                                                                                                            | 13/200 [00:46<11:13,  3.60s/it]  7%|████████                                                                                                            | 14/200 [00:50<10:58,  3.54s/it]  8%|████████▋                                                                                                           | 15/200 [00:53<10:52,  3.53s/it]  8%|█████████▎                                                                                                          | 16/200 [00:57<10:46,  3.51s/it]  8%|█████████▊                                                                                                          | 17/200 [01:00<10:50,  3.56s/it]  9%|██████████▍                                                                                                         | 18/200 [01:04<10:49,  3.57s/it] 10%|███████████                                                                                                         | 19/200 [01:08<11:03,  3.66s/it] 10%|███████████▌                                                                                                        | 20/200 [01:11<10:46,  3.59s/it]                                                                                                                                                          {'loss': 0.1346, 'grad_norm': 1.8944684267044067, 'learning_rate': 0.000181, 'epoch': 0.01}
 10%|███████████▌                                                                                                        | 20/200 [01:11<10:46,  3.59s/it] 10%|████████████▏                                                                                                       | 21/200 [01:15<10:35,  3.55s/it] 11%|████████████▊                                                                                                       | 22/200 [01:18<10:29,  3.54s/it] 12%|█████████████▎                                                                                                      | 23/200 [01:22<10:16,  3.48s/it] 12%|█████████████▉                                                                                                      | 24/200 [01:25<10:23,  3.54s/it] 12%|██████████████▌                                                                                                     | 25/200 [01:30<10:57,  3.76s/it] 13%|███████████████                                                                                                     | 26/200 [01:33<10:34,  3.65s/it] 14%|███████████████▋                                                                                                    | 27/200 [01:36<10:23,  3.60s/it] 14%|████████████████▏                                                                                                   | 28/200 [01:40<10:15,  3.58s/it] 14%|████████████████▊                                                                                                   | 29/200 [01:43<10:04,  3.54s/it] 15%|█████████████████▍                                                                                                  | 30/200 [01:47<10:11,  3.60s/it] 16%|█████████████████▉                                                                                                  | 31/200 [01:51<09:58,  3.54s/it] 16%|██████████████████▌                                                                                                 | 32/200 [01:54<09:49,  3.51s/it] 16%|███████████████████▏                                                                                                | 33/200 [01:57<09:43,  3.49s/it] 17%|███████████████████▋                                                                                                | 34/200 [02:01<09:36,  3.47s/it] 18%|████████████████████▎                                                                                               | 35/200 [02:04<09:27,  3.44s/it] 18%|████████████████████▉                                                                                               | 36/200 [02:08<09:23,  3.43s/it] 18%|█████████████████████▍                                                                                              | 37/200 [02:11<09:23,  3.46s/it] 19%|██████████████████████                                                                                              | 38/200 [02:15<09:19,  3.45s/it] 20%|██████████████████████▌                                                                                             | 39/200 [02:18<09:22,  3.49s/it] 20%|███████████████████████▏                                                                                            | 40/200 [02:22<09:13,  3.46s/it]                                                                                                                                                          {'loss': 0.1604, 'grad_norm': 2.0144059658050537, 'learning_rate': 0.000161, 'epoch': 0.01}
 20%|███████████████████████▏                                                                                            | 40/200 [02:22<09:13,  3.46s/it] 20%|███████████████████████▊                                                                                            | 41/200 [02:25<09:01,  3.40s/it] 21%|████████████████████████▎                                                                                           | 42/200 [02:28<09:01,  3.43s/it] 22%|████████████████████████▉                                                                                           | 43/200 [02:32<08:57,  3.42s/it] 22%|█████████████████████████▌                                                                                          | 44/200 [02:35<08:53,  3.42s/it] 22%|██████████████████████████                                                                                          | 45/200 [02:39<08:48,  3.41s/it] 23%|██████████████████████████▋                                                                                         | 46/200 [02:42<08:55,  3.48s/it] 24%|███████████████████████████▎                                                                                        | 47/200 [02:46<08:50,  3.47s/it] 24%|███████████████████████████▊                                                                                        | 48/200 [02:50<09:28,  3.74s/it] 24%|████████████████████████████▍                                                                                       | 49/200 [02:53<09:06,  3.62s/it] 25%|█████████████████████████████                                                                                       | 50/200 [02:57<09:02,  3.62s/it] 26%|█████████████████████████████▌                                                                                      | 51/200 [03:00<08:48,  3.55s/it] 26%|██████████████████████████████▏                                                                                     | 52/200 [03:04<08:39,  3.51s/it] 26%|██████████████████████████████▋                                                                                     | 53/200 [03:07<08:28,  3.46s/it] 27%|███████████████████████████████▎                                                                                    | 54/200 [03:11<08:23,  3.45s/it] 28%|███████████████████████████████▉                                                                                    | 55/200 [03:14<08:26,  3.50s/it] 28%|████████████████████████████████▍                                                                                   | 56/200 [03:18<08:31,  3.56s/it] 28%|█████████████████████████████████                                                                                   | 57/200 [03:21<08:14,  3.46s/it] 29%|█████████████████████████████████▋                                                                                  | 58/200 [03:24<08:07,  3.43s/it] 30%|██████████████████████████████████▏                                                                                 | 59/200 [03:28<08:02,  3.42s/it] 30%|██████████████████████████████████▊                                                                                 | 60/200 [03:32<08:10,  3.50s/it]                                                                                                                                                          {'loss': 0.184, 'grad_norm': 4.5630388259887695, 'learning_rate': 0.000141, 'epoch': 0.02}
 30%|██████████████████████████████████▊                                                                                 | 60/200 [03:32<08:10,  3.50s/it] 30%|███████████████████████████████████▍                                                                                | 61/200 [03:35<08:11,  3.53s/it] 31%|███████████████████████████████████▉                                                                                | 62/200 [03:39<08:14,  3.58s/it] 32%|████████████████████████████████████▌                                                                               | 63/200 [03:42<07:56,  3.48s/it] 32%|█████████████████████████████████████                                                                               | 64/200 [03:46<07:53,  3.48s/it] 32%|█████████████████████████████████████▋                                                                              | 65/200 [03:49<08:01,  3.56s/it] 33%|██████████████████████████████████████▎                                                                             | 66/200 [03:53<08:02,  3.60s/it] 34%|██████████████████████████████████████▊                                                                             | 67/200 [03:57<08:04,  3.64s/it] 34%|███████████████████████████████████████▍                                                                            | 68/200 [04:00<07:59,  3.63s/it] 34%|████████████████████████████████████████                                                                            | 69/200 [04:04<07:54,  3.62s/it] 35%|████████████████████████████████████████▌                                                                           | 70/200 [04:07<07:46,  3.59s/it] 36%|█████████████████████████████████████████▏                                                                          | 71/200 [04:11<07:46,  3.62s/it] 36%|█████████████████████████████████████████▊                                                                          | 72/200 [04:15<07:34,  3.55s/it] 36%|██████████████████████████████████████████▎                                                                         | 73/200 [04:18<07:34,  3.58s/it] 37%|██████████████████████████████████████████▉                                                                         | 74/200 [04:22<07:23,  3.52s/it] 38%|███████████████████████████████████████████▌                                                                        | 75/200 [04:25<07:29,  3.60s/it] 38%|████████████████████████████████████████████                                                                        | 76/200 [04:29<07:15,  3.51s/it] 38%|████████████████████████████████████████████▋                                                                       | 77/200 [04:32<07:20,  3.58s/it] 39%|█████████████████████████████████████████████▏                                                                      | 78/200 [04:36<07:10,  3.53s/it] 40%|█████████████████████████████████████████████▊                                                                      | 79/200 [04:40<07:14,  3.59s/it] 40%|██████████████████████████████████████████████▍                                                                     | 80/200 [04:43<07:00,  3.51s/it]                                                                                                                                                          {'loss': 0.2248, 'grad_norm': 7.160460472106934, 'learning_rate': 0.000121, 'epoch': 0.02}
 40%|██████████████████████████████████████████████▍                                                                     | 80/200 [04:43<07:00,  3.51s/it] 40%|██████████████████████████████████████████████▉                                                                     | 81/200 [04:46<06:51,  3.45s/it] 41%|███████████████████████████████████████████████▌                                                                    | 82/200 [04:50<06:56,  3.53s/it] 42%|████████████████████████████████████████████████▏                                                                   | 83/200 [04:54<07:04,  3.63s/it] 42%|████████████████████████████████████████████████▋                                                                   | 84/200 [04:57<06:56,  3.59s/it] 42%|█████████████████████████████████████████████████▎                                                                  | 85/200 [05:01<07:03,  3.68s/it] 43%|█████████████████████████████████████████████████▉                                                                  | 86/200 [05:05<06:57,  3.66s/it] 44%|██████████████████████████████████████████████████▍                                                                 | 87/200 [05:08<06:44,  3.58s/it] 44%|███████████████████████████████████████████████████                                                                 | 88/200 [05:12<06:45,  3.62s/it] 44%|███████████████████████████████████████████████████▌                                                                | 89/200 [05:15<06:34,  3.56s/it] 45%|████████████████████████████████████████████████████▏                                                               | 90/200 [05:19<06:28,  3.53s/it] 46%|████████████████████████████████████████████████████▊                                                               | 91/200 [05:22<06:24,  3.53s/it] 46%|█████████████████████████████████████████████████████▎                                                              | 92/200 [05:26<06:23,  3.55s/it] 46%|█████████████████████████████████████████████████████▉                                                              | 93/200 [05:30<06:27,  3.62s/it] 47%|██████████████████████████████████████████████████████▌                                                             | 94/200 [05:33<06:30,  3.68s/it] 48%|███████████████████████████████████████████████████████                                                             | 95/200 [05:37<06:24,  3.66s/it] 48%|███████████████████████████████████████████████████████▋                                                            | 96/200 [05:41<06:18,  3.64s/it] 48%|████████████████████████████████████████████████████████▎                                                           | 97/200 [05:44<06:10,  3.60s/it] 49%|████████████████████████████████████████████████████████▊                                                           | 98/200 [05:48<06:06,  3.59s/it] 50%|█████████████████████████████████████████████████████████▍                                                          | 99/200 [05:51<06:00,  3.57s/it] 50%|█████████████████████████████████████████████████████████▌                                                         | 100/200 [05:55<05:55,  3.55s/it]                                                                                                                                                          {'loss': 0.2627, 'grad_norm': 6.069680690765381, 'learning_rate': 0.000101, 'epoch': 0.03}
 50%|█████████████████████████████████████████████████████████▌                                                         | 100/200 [05:55<05:55,  3.55s/it] 50%|██████████████████████████████████████████████████████████                                                         | 101/200 [05:59<05:55,  3.59s/it] 51%|██████████████████████████████████████████████████████████▋                                                        | 102/200 [06:02<05:49,  3.57s/it] 52%|███████████████████████████████████████████████████████████▏                                                       | 103/200 [06:05<05:43,  3.54s/it] 52%|███████████████████████████████████████████████████████████▊                                                       | 104/200 [06:09<05:39,  3.54s/it] 52%|████████████████████████████████████████████████████████████▍                                                      | 105/200 [06:13<05:37,  3.55s/it] 53%|████████████████████████████████████████████████████████████▉                                                      | 106/200 [06:17<05:44,  3.66s/it] 54%|█████████████████████████████████████████████████████████████▌                                                     | 107/200 [06:20<05:29,  3.54s/it] 54%|██████████████████████████████████████████████████████████████                                                     | 108/200 [06:23<05:25,  3.53s/it] 55%|██████████████████████████████████████████████████████████████▋                                                    | 109/200 [06:27<05:18,  3.50s/it] 55%|███████████████████████████████████████████████████████████████▎                                                   | 110/200 [06:30<05:09,  3.44s/it] 56%|███████████████████████████████████████████████████████████████▊                                                   | 111/200 [06:33<05:07,  3.45s/it] 56%|████████████████████████████████████████████████████████████████▍                                                  | 112/200 [06:37<05:02,  3.43s/it] 56%|████████████████████████████████████████████████████████████████▉                                                  | 113/200 [06:40<04:58,  3.44s/it] 57%|█████████████████████████████████████████████████████████████████▌                                                 | 114/200 [06:44<04:52,  3.40s/it] 57%|██████████████████████████████████████████████████████████████████▏                                                | 115/200 [06:47<04:52,  3.44s/it] 58%|██████████████████████████████████████████████████████████████████▋                                                | 116/200 [06:51<04:53,  3.49s/it] 58%|███████████████████████████████████████████████████████████████████▎                                               | 117/200 [06:54<04:48,  3.48s/it] 59%|███████████████████████████████████████████████████████████████████▊                                               | 118/200 [06:58<04:42,  3.44s/it] 60%|████████████████████████████████████████████████████████████████████▍                                              | 119/200 [07:01<04:32,  3.37s/it] 60%|█████████████████████████████████████████████████████████████████████                                              | 120/200 [07:04<04:34,  3.44s/it]                                                                                                                                                          {'loss': 0.3496, 'grad_norm': 5.7857818603515625, 'learning_rate': 8.1e-05, 'epoch': 0.03}
 60%|█████████████████████████████████████████████████████████████████████                                              | 120/200 [07:04<04:34,  3.44s/it] 60%|█████████████████████████████████████████████████████████████████████▌                                             | 121/200 [07:08<04:38,  3.52s/it] 61%|██████████████████████████████████████████████████████████████████████▏                                            | 122/200 [07:12<04:33,  3.51s/it] 62%|██████████████████████████████████████████████████████████████████████▋                                            | 123/200 [07:15<04:26,  3.46s/it] 62%|███████████████████████████████████████████████████████████████████████▎                                           | 124/200 [07:18<04:25,  3.49s/it] 62%|███████████████████████████████████████████████████████████████████████▉                                           | 125/200 [07:23<04:35,  3.67s/it] 63%|████████████████████████████████████████████████████████████████████████▍                                          | 126/200 [07:26<04:29,  3.64s/it] 64%|█████████████████████████████████████████████████████████████████████████                                          | 127/200 [07:30<04:22,  3.60s/it] 64%|█████████████████████████████████████████████████████████████████████████▌                                         | 128/200 [07:33<04:11,  3.50s/it] 64%|██████████████████████████████████████████████████████████████████████████▏                                        | 129/200 [07:36<04:08,  3.50s/it] 65%|██████████████████████████████████████████████████████████████████████████▊                                        | 130/200 [07:40<04:04,  3.49s/it] 66%|███████████████████████████████████████████████████████████████████████████▎                                       | 131/200 [07:43<03:59,  3.47s/it] 66%|███████████████████████████████████████████████████████████████████████████▉                                       | 132/200 [07:47<03:52,  3.41s/it] 66%|████████████████████████████████████████████████████████████████████████████▍                                      | 133/200 [07:50<03:50,  3.44s/it] 67%|█████████████████████████████████████████████████████████████████████████████                                      | 134/200 [07:54<03:52,  3.52s/it] 68%|█████████████████████████████████████████████████████████████████████████████▋                                     | 135/200 [07:57<03:50,  3.55s/it] 68%|██████████████████████████████████████████████████████████████████████████████▏                                    | 136/200 [08:01<03:45,  3.53s/it] 68%|██████████████████████████████████████████████████████████████████████████████▊                                    | 137/200 [08:04<03:40,  3.50s/it] 69%|███████████████████████████████████████████████████████████████████████████████▎                                   | 138/200 [08:08<03:42,  3.58s/it] 70%|███████████████████████████████████████████████████████████████████████████████▉                                   | 139/200 [08:12<03:37,  3.57s/it] 70%|████████████████████████████████████████████████████████████████████████████████▌                                  | 140/200 [08:15<03:30,  3.51s/it]                                                                                                                                                          {'loss': 0.5341, 'grad_norm': 6.5234246253967285, 'learning_rate': 6.1e-05, 'epoch': 0.04}
 70%|████████████████████████████████████████████████████████████████████████████████▌                                  | 140/200 [08:15<03:30,  3.51s/it] 70%|█████████████████████████████████████████████████████████████████████████████████                                  | 141/200 [08:18<03:25,  3.48s/it] 71%|█████████████████████████████████████████████████████████████████████████████████▋                                 | 142/200 [08:22<03:23,  3.51s/it] 72%|██████████████████████████████████████████████████████████████████████████████████▏                                | 143/200 [08:25<03:18,  3.49s/it] 72%|██████████████████████████████████████████████████████████████████████████████████▊                                | 144/200 [08:29<03:20,  3.58s/it] 72%|███████████████████████████████████████████████████████████████████████████████████▍                               | 145/200 [08:33<03:15,  3.55s/it] 73%|███████████████████████████████████████████████████████████████████████████████████▉                               | 146/200 [08:36<03:08,  3.49s/it] 74%|████████████████████████████████████████████████████████████████████████████████████▌                              | 147/200 [08:39<03:03,  3.46s/it] 74%|█████████████████████████████████████████████████████████████████████████████████████                              | 148/200 [08:43<02:57,  3.42s/it] 74%|█████████████████████████████████████████████████████████████████████████████████████▋                             | 149/200 [08:46<02:55,  3.44s/it] 75%|██████████████████████████████████████████████████████████████████████████████████████▎                            | 150/200 [08:49<02:49,  3.38s/it] 76%|██████████████████████████████████████████████████████████████████████████████████████▊                            | 151/200 [08:53<02:48,  3.43s/it] 76%|███████████████████████████████████████████████████████████████████████████████████████▍                           | 152/200 [08:56<02:44,  3.43s/it] 76%|███████████████████████████████████████████████████████████████████████████████████████▉                           | 153/200 [09:00<02:42,  3.46s/it] 77%|████████████████████████████████████████████████████████████████████████████████████████▌                          | 154/200 [09:03<02:39,  3.47s/it] 78%|█████████████████████████████████████████████████████████████████████████████████████████▏                         | 155/200 [09:07<02:41,  3.60s/it] 78%|█████████████████████████████████████████████████████████████████████████████████████████▋                         | 156/200 [09:11<02:38,  3.60s/it] 78%|██████████████████████████████████████████████████████████████████████████████████████████▎                        | 157/200 [09:15<02:35,  3.63s/it] 79%|██████████████████████████████████████████████████████████████████████████████████████████▊                        | 158/200 [09:18<02:29,  3.57s/it] 80%|███████████████████████████████████████████████████████████████████████████████████████████▍                       | 159/200 [09:21<02:23,  3.49s/it] 80%|████████████████████████████████████████████████████████████████████████████████████████████                       | 160/200 [09:25<02:18,  3.45s/it]                                                                                                                                                          {'loss': 0.7395, 'grad_norm': 9.78435230255127, 'learning_rate': 4.1e-05, 'epoch': 0.05}
 80%|████████████████████████████████████████████████████████████████████████████████████████████                       | 160/200 [09:25<02:18,  3.45s/it] 80%|████████████████████████████████████████████████████████████████████████████████████████████▌                      | 161/200 [09:28<02:15,  3.48s/it] 81%|█████████████████████████████████████████████████████████████████████████████████████████████▏                     | 162/200 [09:32<02:14,  3.53s/it] 82%|█████████████████████████████████████████████████████████████████████████████████████████████▋                     | 163/200 [09:35<02:09,  3.50s/it] 82%|██████████████████████████████████████████████████████████████████████████████████████████████▎                    | 164/200 [09:39<02:05,  3.49s/it] 82%|██████████████████████████████████████████████████████████████████████████████████████████████▉                    | 165/200 [09:42<02:02,  3.50s/it] 83%|███████████████████████████████████████████████████████████████████████████████████████████████▍                   | 166/200 [09:46<01:57,  3.45s/it] 84%|████████████████████████████████████████████████████████████████████████████████████████████████                   | 167/200 [09:49<01:52,  3.42s/it] 84%|████████████████████████████████████████████████████████████████████████████████████████████████▌                  | 168/200 [09:52<01:49,  3.42s/it] 84%|█████████████████████████████████████████████████████████████████████████████████████████████████▏                 | 169/200 [09:56<01:46,  3.44s/it] 85%|█████████████████████████████████████████████████████████████████████████████████████████████████▊                 | 170/200 [09:59<01:41,  3.39s/it] 86%|██████████████████████████████████████████████████████████████████████████████████████████████████▎                | 171/200 [10:03<01:40,  3.46s/it] 86%|██████████████████████████████████████████████████████████████████████████████████████████████████▉                | 172/200 [10:06<01:37,  3.47s/it] 86%|███████████████████████████████████████████████████████████████████████████████████████████████████▍               | 173/200 [10:10<01:33,  3.47s/it] 87%|████████████████████████████████████████████████████████████████████████████████████████████████████               | 174/200 [10:13<01:30,  3.50s/it] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████▋              | 175/200 [10:17<01:27,  3.50s/it] 88%|█████████████████████████████████████████████████████████████████████████████████████████████████████▏             | 176/200 [10:20<01:23,  3.47s/it] 88%|█████████████████████████████████████████████████████████████████████████████████████████████████████▊             | 177/200 [10:24<01:19,  3.47s/it] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████▎            | 178/200 [10:27<01:16,  3.49s/it] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████▉            | 179/200 [10:31<01:15,  3.58s/it] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████▌           | 180/200 [10:34<01:10,  3.52s/it]                                                                                                                                                          {'loss': 1.2751, 'grad_norm': 6.493361949920654, 'learning_rate': 2.1e-05, 'epoch': 0.05}
 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████▌           | 180/200 [10:34<01:10,  3.52s/it] 90%|████████████████████████████████████████████████████████████████████████████████████████████████████████           | 181/200 [10:38<01:07,  3.57s/it] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████▋          | 182/200 [10:42<01:04,  3.61s/it] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▏         | 183/200 [10:45<01:01,  3.60s/it] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▊         | 184/200 [10:49<00:58,  3.65s/it] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▍        | 185/200 [10:53<00:54,  3.64s/it] 93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▉        | 186/200 [10:56<00:49,  3.56s/it] 94%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 187/200 [11:00<00:46,  3.58s/it] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████       | 188/200 [11:03<00:42,  3.51s/it] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▋      | 189/200 [11:07<00:38,  3.45s/it] 95%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▎     | 190/200 [11:10<00:35,  3.52s/it] 96%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▊     | 191/200 [11:14<00:31,  3.49s/it] 96%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▍    | 192/200 [11:17<00:27,  3.46s/it] 96%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▉    | 193/200 [11:20<00:24,  3.44s/it] 97%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌   | 194/200 [11:24<00:20,  3.43s/it] 98%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏  | 195/200 [11:27<00:17,  3.48s/it] 98%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋  | 196/200 [11:31<00:13,  3.49s/it] 98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎ | 197/200 [11:34<00:10,  3.43s/it] 99%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊ | 198/200 [11:38<00:06,  3.48s/it]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍| 199/200 [11:41<00:03,  3.46s/it]100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [11:45<00:00,  3.53s/it]                                                                                                                                                          {'loss': 2.2868, 'grad_norm': 8.034944534301758, 'learning_rate': 1.0000000000000002e-06, 'epoch': 0.06}
100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [11:45<00:00,  3.53s/it]                                                                                                                                                          {'train_runtime': 706.3936, 'train_samples_per_second': 2.265, 'train_steps_per_second': 0.283, 'train_loss': 0.6151696014404296, 'epoch': 0.06}
100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [11:46<00:00,  3.53s/it]100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [11:46<00:00,  3.53s/it]
saved: /workspace/adapters/qlora_run38
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:02<00:06,  2.27s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:04<00:05,  2.52s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:07<00:02,  2.55s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:07<00:02,  2.57s/it]
Traceback (most recent call last):
  File "/workspace/run_cycle.py", line 169, in <module>
    main()
  File "/workspace/run_cycle.py", line 151, in main
    base2 = load_bnb_model()
            ^^^^^^^^^^^^^^^^
  File "/workspace/run_cycle.py", line 48, in load_bnb_model
    model = AutoModelForCausalLM.from_pretrained(BASE_MODEL, quantization_config=bnb, device_map="auto")
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/models/auto/auto_factory.py", line 604, in from_pretrained
    return model_class.from_pretrained(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 277, in _wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 5048, in from_pretrained
    ) = cls._load_pretrained_model(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 5468, in _load_pretrained_model
    _error_msgs, disk_offload_index = load_shard_file(args)
                                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 843, in load_shard_file
    disk_offload_index = _load_state_dict_into_meta_model(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/utils/_contextlib.py", line 120, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/transformers/modeling_utils.py", line 750, in _load_state_dict_into_meta_model
    param = param.to(casting_dtype)
            ^^^^^^^^^^^^^^^^^^^^^^^
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.02 GiB. GPU 0 has a total capacity of 15.48 GiB of which 12.88 MiB is free. Including non-PyTorch memory, this process has 10.75 GiB memory in use. Process 27527 has 4.70 GiB memory in use. Of the allocated memory 10.39 GiB is allocated by PyTorch, and 204.36 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
Traceback (most recent call last):
  File "/workspace/orchestrate_cycle.py", line 404, in <module>
    main()
  File "/workspace/orchestrate_cycle.py", line 369, in main
    subprocess.run(["python3", str(ROOT / "run_cycle.py")], check=True, env=env_train)
  File "/usr/lib/python3.12/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['python3', '/workspace/run_cycle.py']' returned non-zero exit status 1.
[2025-12-27T09:45:03+00:00] RUN: CHOOSE_MODE=loss FORCE_CHOICE=A RANDOM_SEED=
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████                                                                     | 1/4 [00:02<00:07,  2.34s/it]Loading checkpoint shards:  50%|██████████████████████████████████████████████                                              | 2/4 [00:05<00:06,  3.05s/it]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████                       | 3/4 [00:07<00:02,  2.54s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:09<00:00,  2.09s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:09<00:00,  2.31s/it]
Some parameters are on the meta device because they were offloaded to the cpu.
MODE: loss
ADAPTER: /workspace/adapters/qlora_run38
